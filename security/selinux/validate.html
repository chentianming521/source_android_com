<!DOCTYPE html>











































































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="Description" content="Android strongly encourages OEMs to test their SELinux implementations thoroughly. As manufacturers implement SELinux, they should apply the new policy to a test pool of devices first. Once applied, make sure SELinux is running in the correct mode on â€¦">

<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>Validating SELinux | Android Open Source Project</title>

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../assets/css/default.css" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "/";
  
  var devsite = false;
  
</script>
<script src="../../assets/js/docs.js" type="text/javascript"></script>


<script type="text/javascript" src="https://www.gstatic.com/feedback/api.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45455297-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body class="gc-documentation 
  " itemscope itemtype="http://schema.org/Article">
<a name="top"></a>

  
    <!-- Header -->
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 saclogo">
          <a href="../../index.html">
            <img src="../../assets/images/sac_logo.png"
                srcset="/assets/images/sac_logo@2x.png 2x"
                width="123" height="25" alt="Android Open Source Project" />
          </a>
          </div>
            <ul class="nav-x col-9">
                <li class="source">
                  <a href="../../source/index.html" 
                  >Source</a></li>
                <li class="devices"><a href="../../devices/index.html" 
                  >Devices</a></li>
                <li class="security"><a href="../index.html" class="selected"
                  >Security</a></li>
                <li class="compatibility last"><a href="../../compatibility/index.html" 
                  >Compatibility</a></li>
            </ul>
            <!-- New Search -->
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Android Sites</div>
      <ul>
        <li class="active"><a>Android Open Source Project</a></li>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li><a href="http://developer.android.com">Android Developers</a></li>
      </ul>
      <!-- <div class="header">Support</div>
      <ul>
        <li><a href="/support.html">Developer Support</a></li>
      </ul> -->
      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>

  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '/')"
onkeyup="return search_changed(event, false, '/')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>
  <div id="search_filtered_wrapper">
    <div id="search_filtered_div" class="no-display">
        <ul id="search_filtered">
        </ul>
    </div>
  </div>

  </div>
  <!-- /New Search> -->
        </div>
    </div>
    <!-- /Header -->

  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div>

  
  
  
    
  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="validate.html#top" data-g-event="left-nav-top">to top</a>

<!--
    Copyright 2015 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<ul id="nav">
  <li class="nav-section">
    <div class="nav-section-header">
        <a href="../index.html">
          <span class="en">Overview</span>
        </a>
    </div>
    <ul>
      <li><a href="../overview/kernel-security.html">Kernel Security</a></li>
      <li><a href="../overview/app-security.html">App Security</a></li>
      <li><a href="../overview/implement.html">Implementing Security</a></li>
      <li><a href="../overview/updates-resources.html">Updates and Resources</a></li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../enhancements/index.html">
            <span class="en">Enhancements</span>
          </a>
        </div>
        <ul>
          <li><a href="../enhancements/enhancements70.html">Android 7.0</a></li>
          <li><a href="../enhancements/enhancements60.html">Android 6.0</a></li>
          <li><a href="../enhancements/enhancements50.html">Android 5.0</a></li>
          <li><a href="../enhancements/enhancements44.html">Android 4.4</a></li>
          <li><a href="../enhancements/enhancements43.html">Android 4.3</a></li>
          <li><a href="../enhancements/enhancements42.html">Android 4.2</a></li>
          <li><a href="../enhancements/enhancements41.html">Android 4.1</a></li>
        </ul>
      </li>
      <li><a href="../overview/acknowledgements.html">Acknowledgements</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../bulletin/index.html">
        <span class="en">Bulletins</span>
      </a>
    </div>
    <ul>
      <li class="nav-section">
         <div class="nav-section-header">
           <a href="../advisory/index.html">
         <span class="en">Advisories</span>
        </a>
       </div>
         <ul>
           <li><a href="../advisory/2016-03-18.html">2016-03-18</a></li>
         </ul>
      </li>
      <li><a href="../bulletin/2016-08-01.html">August 2016</a></li>
      <li><a href="../bulletin/2016-07-01.html">July 2016</a></li>
      <li><a href="../bulletin/2016-06-01.html">June 2016</a></li>
      <li><a href="../bulletin/2016-05-01.html">May 2016</a></li>
      <li><a href="../bulletin/2016-04-02.html">April 2016</a></li>
      <li><a href="../bulletin/2016-03-01.html">March 2016</a></li>
      <li><a href="../bulletin/2016-02-01.html">February 2016</a></li>
      <li><a href="../bulletin/2016-01-01.html">January 2016</a></li>
      <li class="nav-section">
         <div class="nav-section-header">
           <a href="../bulletin/2015.html">
         <span class="en">2015 Bulletins</span>
        </a>
       </div>
         <ul>
           <li><a href="../bulletin/2015-12-01.html">December 2015</a></li>
           <li><a href="../bulletin/2015-11-01.html">November 2015</a></li>
           <li><a href="../bulletin/2015-10-01.html">October 2015</a></li>
           <li><a href="../bulletin/2015-09-01.html">September 2015</a></li>
           <li><a href="../bulletin/2015-08-01.html">August 2015</a></li>
         </ul>
      </li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../apksigning/index.html">
        <span class="en">Application Signing</span>
      </a>
    </div>
    <ul>
      <li><a href="../apksigning/v2.html">APK Signature Scheme v2</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../authentication/index.html">
        <span class="en">Authentication</span>
      </a>
    </div>
    <ul>
      <li><a href="../../devices/tech/security/authentication/fingerprint-hal.html">Fingerprint HAL</a></li>
      <li><a href="../../devices/tech/security/authentication/gatekeeper.html">Gatekeeper</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../keystore/index.html">
        <span class="en">Keystore</span>
      </a>
    </div>
    <ul>
      <li><a href="../keystore/features.html">Features</a></li>
      <li><a href="../keystore/implementer-ref.html">Implementer's Reference</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../trusty/index.html">
        <span class="en">Trusty TEE</span>
      </a>
    </div>
    <ul>
      <li><a href="../trusty/trusty-ref.html">Trusty API Reference</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../devices/tech/encryption/index.html">
        <span class="en">Encryption</span>
      </a>
    </div>
    <ul>
      <li><a href="../encryption/file-based.html">File-Based Encryption</a></li>
      <li><a href="../encryption/full-disk.html">Full-Disk Encryption</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../devices/tech/security/selinux/index.html">
        <span class="en">SELinux</span>
      </a>
    </div>
    <ul>
      <li><a href="concepts.html">Concepts</a></li>
      <li><a href="implement.html">Implementation</a></li>
      <li><a href="customize.html">Customization</a></li>
      <li><a href="validate.html">Validation</a></li>
      <li><a href="device-policy.html">Writing Policy</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../verifiedboot/index.html">
        <span class="en">Verified Boot</span>
      </a>
    </div>
    <ul>
      <li><a href="../verifiedboot/verified-boot.html">Verifying Boot</a></li>
      <li><a href="../verifiedboot/dm-verity.html">Implementing dm-verity</a></li>
    </ul>
  </li>
</ul>


      </div>
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>

  




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >Validating SELinux</h1>
      
    
  


  
  <div id="jd-content">

    <div class="jd-descr" itemprop="articleBody">
    <!--
    Copyright 2014 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<div id="qv-wrapper">
  <div id="qv">
    <h2>In this document</h2>
    <ol id="auto-toc">
    </ol>
  </div>
</div>

<p>Android strongly encourages OEMs to test their SELinux implementations
thoroughly. As manufacturers implement SELinux, they should apply the new
policy to a test pool of devices first.</p>

<p>Once applied, make sure SELinux is running in the correct mode on the device by
issuing the command:getenforce</p>

<p>This will print the global SELinux mode: either Disabled, Enforcing, or
Permissive. Please note, this command shows only the global SELinux mode. To
determine the SELinux mode for each domain, you must examine the corresponding
files or run the latest version of <code>sepolicy-analyze</code> with the appropriate (-p) flag, present in /platform/system/sepolicy/tools/.</p>

<h2 id=reading_denials>Reading denials</h2>

<p>Then check for errors. Errors are routed as event logs to dmesg and <code>logcat</code> and are viewable locally on the device. Manufacturers should examine the
SELinux output to dmesg on these devices and refine settings prior to public
release in permissive mode and eventual switch to enforcing mode. SELinux log
messages contain "avc:" and so may easily be found with <code>grep</code>. It is
possible to capture the ongoing denial logs by running <code>cat /proc/kmsg</code>
or to capture denial logs from the previous boot by running cat <code>/proc/last_kmsg</code>.</p>

<p>With this output, manufacturers can readily identify when system users or
components are in violation of SELinux policy. Manufacturers can then repair
this bad behavior, either by changes to the software, SELinux policy, or both.</p>

<p>Specifically, these log messages indicate what processes would fail under
enforcing mode and why. Here is an example:</p>

<pre>
avc: denied  { connectto } for  pid=2671 comm="ping" path="/dev/socket/dnsproxyd"
scontext=u:r:shell:s0 tcontext=u:r:netd:s0 tclass=unix_stream_socket
</pre>

<p>Interpret this output like so:</p>

<ul>
  <li> The <code>{ connectto }</code> above represents the action being taken. Together with the
<code>tclass</code> at the end (<code>unix_stream_socket</code>), it tells you roughly what was being done
to what. In this case, something was trying to connect to a unix stream socket.
  <li> The <code>scontext (u:r:shell:s0)</code> tells you what context initiated the action. In
this case this is something running as the shell.
  <li> The <code>tcontext (u:r:netd:s0)</code> tells you the context of the actionâ€™s target. In
this case, thatâ€™s a unix_stream_socket owned by <code>netd</code>.
  <li> The <code>comm="ping"</code> at the top gives you an additional hint about what was being
run at the time the denial was generated. In this case, itâ€™s a pretty good hint.
</ul>

<p>And here is another example:</p>

<pre>
$ adb shell su root dmesg | grep 'avc: '
&lt;5> type=1400 audit: avc:  denied  { read write } for  pid=177
comm="rmt_storage" name="mem" dev="tmpfs" ino=6004 scontext=u:r:rmt:s0
tcontext=u:object_r:kmem_device:s0 tclass=chr_file
</pre>


<p>Here are the key elements from this denial:</p>

<ul>
  <li><em>Action</em> - the attempted action is highlighted in brackets, <code>read write</code> or <code>setenforce</code>. 
  <li><em>Actor</em> - The <code>scontext</code> (source context) entry represents the actor, in this case the<code> rmt_storage</code> daemon.
  <li><em>Object</em> - The <code>tcontext</code> (target context) entry represents the object being acted upon, in this case
kmem.
  <li><em>Result</em> - The <code>tclass</code> (target class) entry indicates the type of object being acted upon, in this
case a <code>chr_file</code> (character device).
</ul>

<h2 id=switching_to_permissive>Switching to permissive</h2>

<p class="caution"><strong>Important:</strong> Permissive mode is not supported on production devices. CTS tests confirm
enforcing mode is enabled.</p>

<p>To turn a deviceâ€™s SELinux enforcement into globally permissive via ADB, as
root issue:</p>

<pre>
$ adb shell su root setenforce 0
</pre>

<p>Or at the kernel command line (during early device bring-up):</p>

<pre>
androidboot.selinux=permissive
androidboot.selinux=disabled
androidboot.selinux=enforcing
</pre>

<h2 id=using_audit2allow>Using audit2allow</h2>

<p>The <code>selinux/policycoreutils/audit2allow</code> tool takes <code>dmesg</code> denials and converts them into corresponding SELinux policy statements. As
such, it can greatly speed SELinux development. To install it, run:</p>

<pre>
$ sudo apt-get install policycoreutils
</pre>

<p>To use it on Ubuntu 12.04, run:</p>

<pre>
$ adb shell su root dmesg | audit2allow
</pre>

<p>On Ubuntu 14.04 and newer, audit2allow requires you to specify the Android policy
using the -p option, e.g.
<pre>
$ adb shell su root dmesg | audit2allow -p out/target/product/&lt;device&gt;/root/sepolicy
</pre>

<p>Nevertheless, care must be taken to examine each potential addition for
overreaching permissions. For example, feeding audit2allow the <code>rmt_storage</code> denial shown earlier results in the following suggested SELinux policy
statement:</p>

<pre>
#============= shell ==============
allow shell kernel:security setenforce;
#============= rmt ==============
allow rmt kmem_device:chr_file { read write };
</pre>


<p>This would grant <code>rmt</code> the ability to write kernel memory, a glaring security hole. Often the <code>audit2allow</code> statements are only a starting point, after which changes to the source
domain, the label of the target and the incorporation of proper macros may be
required to arrive at a good policy. Sometimes the denial being examined should
not result in any policy changes at all, but rather the offending application
should be changed.</p>

    </div>

      <div class="content-footer-sac"
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-9" style="padding-top:4px">
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
    </div> <!-- end jd-content -->
  <div id="footer" class="wrap" >
  <style>.feedback { float: right !Important }</style>
  <div class="feedback">
    <a href="validate.html#" class="button" onclick=" try {
      userfeedback.api.startFeedback({'productId':'715571','authuser':'1'});return false;}catch(e){}">Site Feedback</a>
  </div>
  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  </div>
    <div id="footerlinks">
    
  <p>
    <a href="../../source/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../source/community.html">Community</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
  </p>
  </div>

</div><!-- end doc-content -->

</div> <!-- end body-content --> 






</body>
</html>



