<!DOCTYPE html>











































































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="Description" content="The TV Input Framework (TIF) manager works with the audio routing API to support flexible audio path changes. When a System on Chip (SoC) implements the TV hardware abstraction layer (HAL), each TV input (HDMI IN, Tuner, etc.) provides TvInputHardwareInfoâ€¦">

<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>TV Audio | Android Open Source Project</title>

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../assets/css/default.css" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "/";
  
  var devsite = false;
  
</script>
<script src="../../assets/js/docs.js" type="text/javascript"></script>

<script src="../../navtree_data.js" type="text/javascript"></script>


<script type="text/javascript" src="https://www.gstatic.com/feedback/api.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45455297-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body class="gc-documentation 
  " itemscope itemtype="http://schema.org/Article">
<a name="top"></a>

  
    <!-- Header -->
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 saclogo">
          <a href="../../index.html">
            <img src="../../assets/images/sac_logo.png"
                srcset="/assets/images/sac_logo@2x.png 2x"
                width="123" height="25" alt="Android Open Source Project" />
          </a>
          </div>
            <ul class="nav-x col-9">
                <li class="source">
                  <a href="../../source/index.html" 
                  >Source</a></li>
                <li class="devices"><a href="../index.html" class="selected"
                  >Devices</a></li>
                <li class="security"><a href="../../security/index.html" 
                  >Security</a></li>
                <li class="compatibility last"><a href="../../compatibility/index.html" 
                  >Compatibility</a></li>
            </ul>
            <!-- New Search -->
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Android Sites</div>
      <ul>
        <li class="active"><a>Android Open Source Project</a></li>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li><a href="http://developer.android.com">Android Developers</a></li>
      </ul>
      <!-- <div class="header">Support</div>
      <ul>
        <li><a href="/support.html">Developer Support</a></li>
      </ul> -->
      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>

  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '/')"
onkeyup="return search_changed(event, false, '/')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>
  <div id="search_filtered_wrapper">
    <div id="search_filtered_div" class="no-display">
        <ul id="search_filtered">
        </ul>
    </div>
  </div>

  </div>
  <!-- /New Search> -->
        </div>
    </div>
    <!-- /Header -->

  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div>

  
  
  
    
  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="tv.html#top" data-g-event="left-nav-top">to top</a>

<!--
    Copyright 2015 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<ul id="nav">
  <li class="nav-section">  <!-- Begin nav section, Device Interfaces -->
    <div class="nav-section-header">
      <a href="../index.html">
        <span class="en">Interfaces</span>
      </a>
    </div>
    <ul>
  <li class="nav-section">
  <div class="nav-section-header">
      <a href="../accessories/index.html">
        <span class="en">Accessories</span>
      </a>
    </div>
    <ul>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../accessories/audio.html">
            <span class="en">Audio Accessories</span>
          </a>
        </div>
        <ul>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../accessories/headset/index.html">
            <span class="en">Headset</span>
          </a>
        </div>
        <ul>
          <li><a href="../accessories/headset/specification.html">Specification</a></li>
          <li><a href="../accessories/headset/requirements.html">Requirements</a></li>
          <li><a href="../accessories/headset/testing.html">Testing</a></li>
        </ul>
      </li>
        </ul>
      </li>
  <li class="nav-section">
  <div class="nav-section-header">
      <a href="../accessories/custom.html">
        <span class="en">Custom Accessories</span>
      </a>
    </div>
    <ul>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../accessories/protocol.html"><span class="en">AOA</span>
        </a>
        </div>
        <ul>
          <li><a href="../accessories/aoa2.html">AOA 2.0</a></li>
          <li><a href="../accessories/aoa.html">AOA 1.0</a></li>
        </ul>
        </li>
        <div class="nav-section-header"><a href="../accessories/stylus.html"><span class="en">Stylus</span>
        </a>
        </div>
       </ul>
     </li>
    </ul>
      <li class="nav-section">
      <div class="nav-section-header">
        <a href="index.html">
          <span class="en">Audio</span>
        </a>
      </div>
        <ul>
          <li><a href="terminology.html">Terminology</a></li>
          <li class="nav-section">
            <div class="nav-section-header">
              <a href="implement.html">
                <span class="en">Implementation</span>
              </a>
            </div>
            <ul>
              <li><a href="implement-policy.html">Policy Configuration</a></li>
              <li><a href="implement-shared-library.html">Shared Library</a></li>
              <li><a href="implement-pre-processing.html">Pre-processing Effects</a></li>
            </ul>
         </li>
          <li><a href="data_formats.html">Data Formats</a></li>
          <li><a href="attributes.html">Attributes</a></li>
          <li><a href="warmup.html">Warmup</a></li>
          <li class="nav-section">
            <div class="nav-section-header">
              <a href="latency.html">
                <span class="en">Latency</span>
              </a>
            </div>
            <ul>
              <li><a href="latency_contrib.html">Contributors</a></li>
              <li><a href="latency_design.html">Design</a></li>
              <li><a href="latency_measure.html">Measure</a></li>
              <li><a href="testing_circuit.html">Light Testing Circuit</a></li>
              <li><a href="loopback.html">Audio Loopback Dongle</a></li>
              <li><a href="latency_measurements.html">Measurements</a></li>
              <li><a href="latency_app.html">Applications</a></li>
            </ul>
          </li>
          <li><a href="avoiding_pi.html">Priority Inversion</a></li>
          <li><a href="src.html">Sample Rate Conversion</a></li>
          <li><a href="debugging.html">Debugging</a></li>
          <li class="nav-section">
            <div class="nav-section-header">
              <a href="midi.html">
                <span class="em">MIDI</span>
              </a>
            </div>
            <ul>
              <li><a href="midi_arch.html">MIDI Architecture</a></li>
              <li><a href="midi_test.html">MIDI Test Procedure</a></li>
            </ul>
          <li><a href="usb.html">USB Digital Audio</a></li>
          <li><a href="tv.html">TV Audio</a></li>
        </ul>
      </li>
      <li><a href="../automotive.html">Automotive</a></li>
      <li><a href="../bluetooth.html">Bluetooth</a></li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../camera/index.html">
            <span class="en">Camera</span>
          </a>
        </div>
        <ul>
          <li><a href="../camera/camera3.html">Camera HAL3</a></li>
          <li><a href="../camera/camera3_requests_hal.html">HAL Subsystem</a></li>
          <li><a href="../camera/camera3_metadata.html">Metadata and Controls</a></li>
          <li><a href="../camera/camera3_3Amodes.html">3A Modes and State</a></li>
          <li><a href="../camera/camera3_crop_reprocess.html">Output and Cropping</a></li>
          <li><a href="../camera/camera3_error_stream.html">Errors and Streams</a></li>
          <li><a href="../camera/camera3_requests_methods.html">Request Creation</a></li>
          <li><a href="../camera/versioning.html">Version Support</a></li>
        </ul>
      </li>

      <li><a href="../drm.html">DRM</a></li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../graphics/index.html">
            <span class="en">Graphics</span>
          </a>
        </div>
        <ul>
         <li class="nav-section">
            <div class="nav-section-header">
              <a href="../graphics/architecture.html">
                <span class="en">Architecture</span>
              </a>
            </div>
            <ul>
              <li><a href="../graphics/arch-bq-gralloc.html">BufferQueue</a></li>
              <li><a href="../graphics/arch-sf-hwc.html">SurfaceFlinger and HWC</a></li>
              <li><a href="../graphics/arch-sh.html">Surface and SurfaceHolder</a></li>
              <li><a href="../graphics/arch-egl-opengl.html">OpenGL ES</a></li>
              <li><a href="../graphics/arch-vulkan.html">Vulkan</a></li>
              <li><a href="../graphics/arch-sv-glsv.html">SurfaceView</a></li>
              <li><a href="../graphics/arch-st.html">SurfaceTexture</a></li>
              <li><a href="../graphics/arch-tv.html">TextureView</a></li>
              <li><a href="../graphics/arch-gameloops.html">Game Loops</a></li>
            </ul>
         </li>
         <li class="nav-section">
            <div class="nav-section-header">
              <a href="../graphics/implement.html">
                <span class="en">Implementing</span>
              </a>
            </div>
            <ul>
              <li><a href="../graphics/implement-hwc.html">Hardware Composer HAL</a></li>
              <li><a href="../graphics/implement-vsync.html">VSYNC</a></li>
              <li><a href="../graphics/implement-vulkan.html">Vulkan</a></li>
              <li><a href="../graphics/implement-vdisplays.html">Virtual Displays</a></li>
            </ul>
         </li>
         <li class="nav-section">
            <div class="nav-section-header">
              <a href="../graphics/testing.html">
                <span class="en">OpenGL ES Testing</span>
              </a>
            </div>
            <ul>
              <li><a href="../graphics/build-tests.html">Building test programs</a></li>
              <li><a href="../graphics/port-tests.html">Porting the test framework</a></li>
              <li><a href="../graphics/run-tests.html">Running the tests</a></li>
              <li><a href="../graphics/automate-tests.html">Automating the tests</a></li>
              <li><a href="../graphics/test-groups.html">Using special test groups</a></li>
              <li><a href="../graphics/cts-integration.html">Integrating with Android CTS</a></li>
            </ul>
         </li>
        </ul> </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../input/index.html">
            <span class="en">Input</span>
          </a>
        </div>
        <ul>
          <li><a href="../input/overview.html">Overview</a></li>
          <li><a href="../input/key-layout-files.html">Key Layout Files</a></li>
          <li><a href="../input/key-character-map-files.html">Key Character Map Files</a></li>
          <li><a href="../input/input-device-configuration-files.html">Input Device Configuration Files</a></li>
          <li><a href="../input/migration-guide.html">Migration Guide</a></li>
          <li><a href="../input/keyboard-devices.html">Keyboard Devices</a></li>
          <li><a href="../tech/input/touch-devices.html">Touch Devices</a></li>
          <li><a href="../tech/input/dumpsys.html">Diagnostics</a></li>
          <li><a href="../input/getevent.html">Getevent</a></li>
          <li><a href="../input/validate-keymaps.html">Validate Keymaps</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../media.html">
            <span class="en">Media</span>
          </a>
        </div>
        <ul>
          <li><a href="../media/framework-hardening.html">Framework
          Hardening</a></li>
          <li><a href="../media/soc.html">SoC Dependencies</a></li>
          <li><a href="../media/oem.html">OEM Dependencies</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../sensors/index.html">
            <span class="en">Sensors</span>
          </a>
        </div>
        <ul>
          <li><a href="../sensors/sensor-stack.html">Sensor stack</a></li>
          <li><a href="../sensors/report-modes.html">Reporting modes</a></li>
          <li><a href="../sensors/suspend-mode.html">Suspend mode</a></li>
          <li><a href="../sensors/power-use.html">Power consumption</a></li>
          <li><a href="../sensors/interaction.html">Interaction</span></a></li>
          <li><a href="../sensors/hal-interface.html">HAL interface</a></li>
          <li><a href="../sensors/batching.html">Batching</a></li>
          <li><a href="../sensors/sensor-types.html">Sensor types</a></li>
          <li><a href="../sensors/versioning.html">Version deprecation</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="https://source.android.com/devices/storage/index.html">
            <span class="en">Storage</span>
          </a>
        </div>
        <ul>
          <li><a href="../storage/traditional.html">Traditional Storage</a></li>
          <li><a href="../storage/adoptable.html">Adoptable Storage</a></li>
          <li><a href="../storage/config.html">Device Configuration</a></li>
          <li><a href="../storage/config-example.html">Configuration Examples</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../tv/index.html">
            <span class="en">TV</span>
          </a>
        </div>
        <ul>
          <li><a href="../tv/HDMI-CEC.html">HDMI-CEC control service</a></li>
          <li><a href="../tv/reference-tv-app.html">Reference TV App</a></li>
        </ul>
      </li>
    </ul>
  </li> <!-- End nav-section, Device Interfaces-->


  <li class="nav-section"> <!--Begin nav-section, Core Technologies-->
    <div class="nav-section-header">
      <a href="../tech/index.html">
        <span class="en">Core Technologies</span>
      </a>
    </div>

    <ul>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../tech/dalvik/index.html">
          <span class="en">ART and Dalvik</span></a>
        </div>
        <ul>
          <li><a href="../tech/dalvik/dalvik-bytecode.html">Bytecode Format</a></li>
          <li><a href="../tech/dalvik/dex-format.html">.Dex Format</a></li>
          <li><a href="../tech/dalvik/instruction-formats.html">Instruction Formats</a></li>
          <li><a href="../tech/dalvik/constraints.html">Constraints</a></li>
          <li><a href="../tech/dalvik/configure.html">Configuration</a></li>
          <li><a href="../tech/dalvik/gc-debug.html">Garbage Collection</a></li>
          <li><a href="../tech/dalvik/jit-compiler.html">JIT Compilation</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../tech/config/index.html">
              <span class="en">Configuration</span>
            </a>
        </div>
        <ul>
          <li><a href="../tech/config/carrier.html">Carrier Customization</a></li>
          <li><a href="../tech/config/connect_tests.html">Connectivity Tests</a></li>
          <li><a href="../tech/config/filesystem.html">File System</a></li>
          <li><a href="../tech/kernel.html">Kernel Configuration</a></li>
          <li><a href="../tech/config/kernel_network_tests.html">Kernel Network Tests</a></li>
          <li><a href="../tech/config/low-ram.html">Low RAM</a></li>
          <li><a href="../tech/config/namespaces_libraries.html">Namespaces for Libraries</a></li>
          <li><a href="../tech/config/renderer.html">OpenGLRenderer</a></li>
          <li><a href="../tech/config/runtime_perms.html">Runtime Permissions</a></li>
          <li><a href="../tech/config/uicc.html">UICC</a></li>
          <li><a href="../tech/config/voicemail.html">Visual Voicemail</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../tech/connect/index.html">
              <span class="en">Connectivity</span>
            </a>
        </div>
        <ul>
          <li><a href="../tech/connect/block-numbers.html">Block Phone Numbers</a></li>
          <li><a href="../tech/connect/call-notification.html">Call Notifications</a></li>
          <li><a href="../tech/connect/data-saver.html">Data Saver Mode</a></li>
          <li><a href="../tech/connect/felica.html">Host Card Emulation of FeliCa</a></li>
          <li><a href="../tech/connect/ril.html">Radio Interface Layer (RIL)</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../tech/datausage/index.html">
            <span class="en">Data Usage</span>
          </a>
        </div>
        <ul>
          <li><a href="../tech/datausage/iface-overview.html">Network interface statistics overview</a></li>
          <li><a href="../tech/datausage/excluding-network-types.html">Excluding Network Types from Data Usage</a></li>
          <li><a href="../tech/datausage/tethering-data.html">Tethering Data</a></li>
          <li><a href="../tech/datausage/usage-cycle-resets-dates.html">Usage Cycle Reset Dates</a></li>
          <li><a href="../tech/datausage/kernel-overview.html">Kernel Overview</a></li>
          <li><a href="../tech/datausage/tags-explained.html">Data Usage Tags Explained</a></li>
          <li><a href="../tech/datausage/kernel-changes.html">Kernel Changes</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../tech/debug/index.html">
            <span class="en">Debugging</span>
          </a>
        </div>
        <ul>
          <li><a href="../tech/debug/asan.html">AddressSanitizer</a></li>
          <li><a href="../tech/debug/dumpsys.html">Dumpsys</a></li>
          <li><a href="../tech/debug/native-memory.html">Native Memory Use</a></li>
          <li><a href="../tech/debug/netstats.html">Network Use</a></li>
          <li><a href="../tech/debug/procstats.html">RAM Use</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../tech/admin/index.html">
          <span class="en">Device Administration</span></a>
        </div>
        <ul>
          <li><a href="../tech/admin/implement.html">Implementation</a></li>
          <li><a href="../tech/admin/multi-user.html">Multiple Users</a></li>
          <li><a href="../tech/admin/managed-profiles.html">Managed Profiles</a></li>
          <li><a href="../tech/admin/provision.html">Provisioning</a></li>
          <li><a href="../tech/admin/multiuser-apps.html">Multiuser Apps</a></li>
          <li><a href="../tech/admin/enterprise-telephony.html">Enterprise Telephony</a></li>
          <li><a href="../tech/admin/testing-provision.html">Testing Device Provisioning</a></li>
          <li><a href="../tech/admin/testing-setup.html">Testing Device Administration</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../tech/display/index.html">
              <span class="en">Display Settings</span></a>
        </div>
        <ul>
          <li><a href="../tech/display/dnd.html">Do Not Disturb</a></li>
          <li><a href="../tech/display/multi-window.html">Multi-Window</a></li>
          <li><a href="../tech/display/hdr.html">HDR Video</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header empty">
          <a href="../halref/index.html">
            <span class="en">HAL File Reference</span>
          </a>
        </div>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../tech/ota/index.html">
              <span class="en">OTA Updates</span>
            </a>
        </div>
        <ul>
          <li><a href="../tech/ota/tools.html">OTA Tools</a></li>
          <li><a href="../tech/ota/block.html">Block-based OTA</a></li>
          <li><a href="../tech/ota/inside_packages.html">Inside OTA Packages</a></li>
          <li><a href="../tech/ota/device_code.html">Device-Specific Code</a></li>
          <li><a href="../tech/ota/reduce_size.html">Reducing OTA Size</a></li>
          <li><a href="../tech/ota/sign_builds.html">Signing Builds for Release</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../tech/power/index.html"><span class="en">Power</span></a>
        </div>
        <ul>
          <li><a href="../tech/power/mgmt.html">Power Management</a></li>
          <li><a href="../tech/power/performance.html">Performance Management</a></li>
          <li><a href="../tech/power/component.html">Component Power</a></li>
          <li><a href="../tech/power/device.html">Device Power</a></li>
          <li><a href="../tech/power/values.html">Power Values</a></li>
          <li><a href="../tech/power/batterystats.html">Battery Use</a>
          </li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../tech/test_infra/tradefed/index.html">
            <span class="en">Testing Infrastructure</span>
          </a>
        </div>
        <ul>
          <li><a href="../tech/test_infra/tradefed/fundamentals/index.html">Start Here</a></li>
          <li><a href="../tech/test_infra/tradefed/fundamentals/machine_setup.html">Machine Setup</a></li>
          <li><a href="../tech/test_infra/tradefed/fundamentals/devices.html">Working with Devices</a></li>
          <li><a href="../tech/test_infra/tradefed/fundamentals/lifecycle.html">Test Lifecycle</a></li>
          <li><a href="../tech/test_infra/tradefed/fundamentals/options.html">Option Handling</a></li>
          <li><a href="../tech/test_infra/tradefed/full_example.html">An End-to-End Example</a></li>
          <li id="tradefed-tree-list" class="nav-section">
            <div class="nav-section-header">
              <a href="../../reference/packages.html">
                <span class="en">Package Index</span>
              </a>
            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li> <!-- End nav-section, Core Technologies -->
</ul> 


      </div>
      <script type="text/javascript">
        showTradefedRefTree();
      </script>
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>

  




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >TV Audio</h1>
      
    
  


  
  <div id="jd-content">

    <div class="jd-descr" itemprop="articleBody">
    <!--
    Copyright 2015 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<div id="qv-wrapper">
  <div id="qv">
    <h2>In this document</h2>
    <ol id="auto-toc">
    </ol>
  </div>
</div>

<p>The TV Input Framework (TIF) manager works with the audio routing API to support flexible audio
path changes. When a System on Chip (SoC) implements the TV hardware abstraction layer (HAL), each
TV input (HDMI IN, Tuner, etc.) provides <code>TvInputHardwareInfo</code> that specifies AudioPort information for audio type and address.</p>

<ul>
<li><b>Physical</b> audio input/output devices have a corresponding AudioPort.</li>
<li><b>Software</b> audio output/input streams are represented as AudioMixPort (child class of
AudioPort).</li>
</ul>

<p>The TIF then uses AudioPort information for the audio routing API.</p>

<p><img src="images/ape_audio_tv_tif.png" alt="Android TV Input Framework (TIF)" /></p>
<p class="img-caption"><strong>Figure 1.</strong> TV Input Framework (TIF)</p>

<h2 id="requirements">Requirements</h2>

<p>A SoC must implement the audio HAL with the following audio routing API support:</p>

<table>
<tbody>
<tr>
<th>Audio Ports</th>
<td>
<ul>
<li>TV Audio Input has a corresponding audio source port implementation.</li>
<li>TV Audio Output has a corresponding audio sink port implementation.</li>
<li>Can create audio patch between any TV input audio port and any TV output audio port.</li>
</ul>
</td>
</tr>
<tr>
<th>Default Input</th>
<td>AudioRecord (created with DEFAULT input source) must seize <i>virtual null input source</i> for
AUDIO_DEVICE_IN_DEFAULT acquisition on Android TV.</td>
</tr>
<tr>
<th>Device Loopback</th>
<td>Requires supporting an AUDIO_DEVICE_IN_LOOPBACK input that is a complete mix of all audio output
of all the TV output (11Khz, 16bit mono or 48Khz, 16bit mono). Used only for audio capture.
</td>
</tr>
</tbody>
</table>


<h2 id="audioDevices">TV audio devices</h2>

<p>Android supports the following audio devices for TV audio input/output.</p>

<h4>system/media/audio/include/system/audio.h</h4>

<p class="note"><strong>Note:</strong> In Android 5.1 and earlier, the path to
this file is: <code>system/core/include/system/audio.h</code></p>

<pre>
/* output devices */
AUDIO_DEVICE_OUT_AUX_DIGITAL  = 0x400,
AUDIO_DEVICE_OUT_HDMI   = AUDIO_DEVICE_OUT_AUX_DIGITAL,
/* HDMI Audio Return Channel */
AUDIO_DEVICE_OUT_HDMI_ARC   = 0x40000,
/* S/PDIF out */
AUDIO_DEVICE_OUT_SPDIF    = 0x80000,
/* input devices */
AUDIO_DEVICE_IN_AUX_DIGITAL   = AUDIO_DEVICE_BIT_IN | 0x20,
AUDIO_DEVICE_IN_HDMI      = AUDIO_DEVICE_IN_AUX_DIGITAL,
/* TV tuner input */
AUDIO_DEVICE_IN_TV_TUNER    = AUDIO_DEVICE_BIT_IN | 0x4000,
/* S/PDIF in */
AUDIO_DEVICE_IN_SPDIF   = AUDIO_DEVICE_BIT_IN | 0x10000,
AUDIO_DEVICE_IN_LOOPBACK    = AUDIO_DEVICE_BIT_IN | 0x40000,
</pre>


<h2 id="halExtension">Audio HAL extension</h2>

<p>The Audio HAL extension for the audio routing API is defined by following:</p>

<h4>system/media/audio/include/system/audio.h</h4>

<p class="note"><strong>Note:</strong> In Android 5.1 and earlier, the path to
this file is: <code>system/core/include/system/audio.h</code></p>

<pre>
/* audio port configuration structure used to specify a particular configuration of an audio port */
struct audio_port_config {
    audio_port_handle_t      id;           /* port unique ID */
    audio_port_role_t        role;         /* sink or source */
    audio_port_type_t        type;         /* device, mix ... */
    unsigned int             config_mask;  /* e.g AUDIO_PORT_CONFIG_ALL */
    unsigned int             sample_rate;  /* sampling rate in Hz */
    audio_channel_mask_t     channel_mask; /* channel mask if applicable */
    audio_format_t           format;       /* format if applicable */
    struct audio_gain_config gain;         /* gain to apply if applicable */
    union {
        struct audio_port_config_device_ext  device;  /* device specific info */
        struct audio_port_config_mix_ext     mix;     /* mix specific info */
        struct audio_port_config_session_ext session; /* session specific info */
    } ext;
};
struct audio_port {
    audio_port_handle_t      id;                /* port unique ID */
    audio_port_role_t        role;              /* sink or source */
    audio_port_type_t        type;              /* device, mix ... */
    unsigned int             num_sample_rates;  /* number of sampling rates in following array */
    unsigned int             sample_rates[AUDIO_PORT_MAX_SAMPLING_RATES];
    unsigned int             num_channel_masks; /* number of channel masks in following array */
    audio_channel_mask_t     channel_masks[AUDIO_PORT_MAX_CHANNEL_MASKS];
    unsigned int             num_formats;       /* number of formats in following array */
    audio_format_t           formats[AUDIO_PORT_MAX_FORMATS];
    unsigned int             num_gains;         /* number of gains in following array */
    struct audio_gain        gains[AUDIO_PORT_MAX_GAINS];
    struct audio_port_config active_config;     /* current audio port configuration */
    union {
        struct audio_port_device_ext  device;
        struct audio_port_mix_ext     mix;
        struct audio_port_session_ext session;
    } ext;
};
</pre>

<h4>hardware/libhardware/include/hardware/audio.h</h4>

<pre>
struct audio_hw_device {
  :
    /**
     * Routing control
     */

    /* Creates an audio patch between several source and sink ports.
     * The handle is allocated by the HAL and should be unique for this
     * audio HAL module. */
    int (*create_audio_patch)(struct audio_hw_device *dev,
                               unsigned int num_sources,
                               const struct audio_port_config *sources,
                               unsigned int num_sinks,
                               const struct audio_port_config *sinks,
                               audio_patch_handle_t *handle);

    /* Release an audio patch */
    int (*release_audio_patch)(struct audio_hw_device *dev,
                               audio_patch_handle_t handle);

    /* Fills the list of supported attributes for a given audio port.
     * As input, "port" contains the information (type, role, address etc...)
     * needed by the HAL to identify the port.
     * As output, "port" contains possible attributes (sampling rates, formats,
     * channel masks, gain controllers...) for this port.
     */
    int (*get_audio_port)(struct audio_hw_device *dev,
                          struct audio_port *port);

    /* Set audio port configuration */
    int (*set_audio_port_config)(struct audio_hw_device *dev,
                         const struct audio_port_config *config);
</pre>

<h2 id="testing">Testing DEVICE_IN_LOOPBACK</h2>

<p>To test DEVICE_IN_LOOPBACK for TV monitoring, use the following testing code. After running the
test, the captured audio saves to <code>/sdcard/record_loopback.raw</code>, where you can listen to
it using <code>ffmeg</code>.</p>

<pre>
&lt;uses-permission android:name="android.permission.MODIFY_AUDIO_ROUTING" /&gt;
&lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;

   AudioRecord mRecorder;
   Handler mHandler = new Handler();
   int mMinBufferSize = AudioRecord.getMinBufferSize(RECORD_SAMPLING_RATE,
           AudioFormat.CHANNEL_IN_MONO,
           AudioFormat.ENCODING_PCM_16BIT);;
   static final int RECORD_SAMPLING_RATE = 48000;
   public void doCapture() {
       mRecorder = new AudioRecord(MediaRecorder.AudioSource.DEFAULT, RECORD_SAMPLING_RATE,
               AudioFormat.CHANNEL_IN_MONO, AudioFormat.ENCODING_PCM_16BIT, mMinBufferSize * 10);
       AudioManager am = (AudioManager) getSystemService(Context.AUDIO_SERVICE);
       ArrayList&lt;AudioPort&gt; audioPorts = new ArrayList&lt;AudioPort&gt;();
       am.listAudioPorts(audioPorts);
       AudioPortConfig srcPortConfig = null;
       AudioPortConfig sinkPortConfig = null;
       for (AudioPort audioPort : audioPorts) {
           if (srcPortConfig == null
                   &amp;&amp; audioPort.role() == AudioPort.ROLE_SOURCE
                   &amp;&amp; audioPort instanceof AudioDevicePort) {
               AudioDevicePort audioDevicePort = (AudioDevicePort) audioPort;
               if (audioDevicePort.type() == AudioManager.DEVICE_IN_LOOPBACK) {
                   srcPortConfig = audioPort.buildConfig(48000, AudioFormat.CHANNEL_IN_DEFAULT,
                           AudioFormat.ENCODING_DEFAULT, null);
                   Log.d(LOG_TAG, "Found loopback audio source port : " + audioPort);
               }
           }
           else if (sinkPortConfig == null
                   &amp;&amp; audioPort.role() == AudioPort.ROLE_SINK
                   &amp;&amp; audioPort instanceof AudioMixPort) {
               sinkPortConfig = audioPort.buildConfig(48000, AudioFormat.CHANNEL_OUT_DEFAULT,
                       AudioFormat.ENCODING_DEFAULT, null);
               Log.d(LOG_TAG, "Found recorder audio mix port : " + audioPort);
           }
       }
       if (srcPortConfig != null &amp;&amp; sinkPortConfig != null) {
           AudioPatch[] patches = new AudioPatch[] { null };
           int status = am.createAudioPatch(
                   patches,
                   new AudioPortConfig[] { srcPortConfig },
                   new AudioPortConfig[] { sinkPortConfig });
           Log.d(LOG_TAG, "Result of createAudioPatch(): " + status);
       }
       mRecorder.startRecording();
       processAudioData();
       mRecorder.stop();
       mRecorder.release();
   }
   private void processAudioData() {
       OutputStream rawFileStream = null;
       byte data[] = new byte[mMinBufferSize];
       try {
           rawFileStream = new BufferedOutputStream(
                   new FileOutputStream(new File("/sdcard/record_loopback.raw")));
       } catch (FileNotFoundException e) {
           Log.d(LOG_TAG, "Can't open file.", e);
       }
       long startTimeMs = System.currentTimeMillis();
       while (System.currentTimeMillis() - startTimeMs &lt; 5000) {
           int nbytes = mRecorder.read(data, 0, mMinBufferSize);
           if (nbytes &lt;= 0) {
               continue;
           }
           try {
               rawFileStream.write(data);
           } catch (IOException e) {
               Log.e(LOG_TAG, "Error on writing raw file.", e);
           }
       }
       try {
           rawFileStream.close();
       } catch (IOException e) {
       }
       Log.d(LOG_TAG, "Exit audio recording.");
   }
</pre>

<p>Locate the captured audio file in <code>/sdcard/record_loopback.raw</code> and listen to it using
<code>ffmeg</code>:</p>

<pre>
adb pull /sdcard/record_loopback.raw
ffmpeg -f s16le -ar 48k -ac 1 -i record_loopback.raw record_loopback.wav
ffplay record_loopback.wav
</pre>

<h2 id="useCases">Use cases</h2>

<p>This section includes common use cases for TV audio.</p>

<h3 id="tvSpeaker">TV tuner with speaker output</h3>

<p>When a TV tuner becomes active, the audio routing API creates an audio patch between the tuner
and the default output (e.g. the speaker). The tuner output does not require decoding, but final
audio output is mixed with software output_stream.</p>

<img src="images/ape_audio_tv_tuner.png" alt="Android TV Tuner Audio Patch" />
<p class="img-caption">
<strong>Figure 2.</strong> Audio Patch for TV tuner with speaker output.</p>


<h3 id="hdmiOut">HDMI OUT during live TV</h3>

<p>A user is watching live TV then switches to the HDMI audio output (Intent.ACTION_HDMI_AUDIO_PLUG)
. The output device of all output_streams changes to the HDMI_OUT port, and the TIF manager changes
the sink port of the existing tuner audio patch to the HDMI_OUT port.</p>

<img src="images/ape_audio_tv_hdmi_tuner.png" alt="Android TV HDMI-OUT Audio Patch" />
<p class="img-caption">
<strong>Figure 3.</strong> Audio Patch for HDMI OUT from live TV.</p>

    </div>

      <div class="content-footer-sac"
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-9" style="padding-top:4px">
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
    </div> <!-- end jd-content -->
  <div id="footer" class="wrap" >
  <style>.feedback { float: right !Important }</style>
  <div class="feedback">
    <a href="tv.html#" class="button" onclick=" try {
      userfeedback.api.startFeedback({'productId':'715571','authuser':'1'});return false;}catch(e){}">Site Feedback</a>
  </div>
  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  </div>
    <div id="footerlinks">
    
  <p>
    <a href="../../source/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../source/community.html">Community</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
  </p>
  </div>

</div><!-- end doc-content -->

</div> <!-- end body-content --> 






</body>
</html>



