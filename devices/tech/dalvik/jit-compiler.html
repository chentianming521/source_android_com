<!DOCTYPE html>











































































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="Description" content="Android 7.0 adds a just-in-time (JIT) compiler with code profiling to Android runtime (ART) that constantly improves the performance of Android apps as they run. The JIT compiler complements ART&#39;s current ahead-of-time (AOT) compiler and improves â€¦">

<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico" />
<title>Implementing ART Just-In-Time (JIT) Compiler | Android Open Source Project</title>

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../../assets/css/default.css" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "/";
  
  var devsite = false;
  
</script>
<script src="../../../assets/js/docs.js" type="text/javascript"></script>

<script src="../../../navtree_data.js" type="text/javascript"></script>


<script type="text/javascript" src="https://www.gstatic.com/feedback/api.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45455297-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body class="gc-documentation 
  " itemscope itemtype="http://schema.org/Article">
<a name="top"></a>

  
    <!-- Header -->
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 saclogo">
          <a href="../../../index.html">
            <img src="../../../assets/images/sac_logo.png"
                srcset="/assets/images/sac_logo@2x.png 2x"
                width="123" height="25" alt="Android Open Source Project" />
          </a>
          </div>
            <ul class="nav-x col-9">
                <li class="source">
                  <a href="../../../source/index.html" 
                  >Source</a></li>
                <li class="devices"><a href="../../index.html" class="selected"
                  >Devices</a></li>
                <li class="security"><a href="../../../security/index.html" 
                  >Security</a></li>
                <li class="compatibility last"><a href="../../../compatibility/index.html" 
                  >Compatibility</a></li>
            </ul>
            <!-- New Search -->
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Android Sites</div>
      <ul>
        <li class="active"><a>Android Open Source Project</a></li>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li><a href="http://developer.android.com">Android Developers</a></li>
      </ul>
      <!-- <div class="header">Support</div>
      <ul>
        <li><a href="/support.html">Developer Support</a></li>
      </ul> -->
      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>

  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '/')"
onkeyup="return search_changed(event, false, '/')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>
  <div id="search_filtered_wrapper">
    <div id="search_filtered_div" class="no-display">
        <ul id="search_filtered">
        </ul>
    </div>
  </div>

  </div>
  <!-- /New Search> -->
        </div>
    </div>
    <!-- /Header -->

  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div>

  
  
  
    
  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="jit-compiler.html#top" data-g-event="left-nav-top">to top</a>

<!--
    Copyright 2015 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<ul id="nav">
  <li class="nav-section">  <!-- Begin nav section, Device Interfaces -->
    <div class="nav-section-header">
      <a href="../../index.html">
        <span class="en">Interfaces</span>
      </a>
    </div>
    <ul>
  <li class="nav-section">
  <div class="nav-section-header">
      <a href="../../accessories/index.html">
        <span class="en">Accessories</span>
      </a>
    </div>
    <ul>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../accessories/audio.html">
            <span class="en">Audio Accessories</span>
          </a>
        </div>
        <ul>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../accessories/headset/index.html">
            <span class="en">Headset</span>
          </a>
        </div>
        <ul>
          <li><a href="../../accessories/headset/specification.html">Specification</a></li>
          <li><a href="../../accessories/headset/requirements.html">Requirements</a></li>
          <li><a href="../../accessories/headset/testing.html">Testing</a></li>
        </ul>
      </li>
        </ul>
      </li>
  <li class="nav-section">
  <div class="nav-section-header">
      <a href="../../accessories/custom.html">
        <span class="en">Custom Accessories</span>
      </a>
    </div>
    <ul>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../accessories/protocol.html"><span class="en">AOA</span>
        </a>
        </div>
        <ul>
          <li><a href="../../accessories/aoa2.html">AOA 2.0</a></li>
          <li><a href="../../accessories/aoa.html">AOA 1.0</a></li>
        </ul>
        </li>
        <div class="nav-section-header"><a href="../../accessories/stylus.html"><span class="en">Stylus</span>
        </a>
        </div>
       </ul>
     </li>
    </ul>
      <li class="nav-section">
      <div class="nav-section-header">
        <a href="../../audio/index.html">
          <span class="en">Audio</span>
        </a>
      </div>
        <ul>
          <li><a href="../../audio/terminology.html">Terminology</a></li>
          <li class="nav-section">
            <div class="nav-section-header">
              <a href="../../audio/implement.html">
                <span class="en">Implementation</span>
              </a>
            </div>
            <ul>
              <li><a href="../../audio/implement-policy.html">Policy Configuration</a></li>
              <li><a href="../../audio/implement-shared-library.html">Shared Library</a></li>
              <li><a href="../../audio/implement-pre-processing.html">Pre-processing Effects</a></li>
            </ul>
         </li>
          <li><a href="../../audio/data_formats.html">Data Formats</a></li>
          <li><a href="../../audio/attributes.html">Attributes</a></li>
          <li><a href="../../audio/warmup.html">Warmup</a></li>
          <li class="nav-section">
            <div class="nav-section-header">
              <a href="../../audio/latency.html">
                <span class="en">Latency</span>
              </a>
            </div>
            <ul>
              <li><a href="../../audio/latency_contrib.html">Contributors</a></li>
              <li><a href="../../audio/latency_design.html">Design</a></li>
              <li><a href="../../audio/latency_measure.html">Measure</a></li>
              <li><a href="../../audio/testing_circuit.html">Light Testing Circuit</a></li>
              <li><a href="../../audio/loopback.html">Audio Loopback Dongle</a></li>
              <li><a href="../../audio/latency_measurements.html">Measurements</a></li>
              <li><a href="../../audio/latency_app.html">Applications</a></li>
            </ul>
          </li>
          <li><a href="../../audio/avoiding_pi.html">Priority Inversion</a></li>
          <li><a href="../../audio/src.html">Sample Rate Conversion</a></li>
          <li><a href="../../audio/debugging.html">Debugging</a></li>
          <li class="nav-section">
            <div class="nav-section-header">
              <a href="../../audio/midi.html">
                <span class="em">MIDI</span>
              </a>
            </div>
            <ul>
              <li><a href="../../audio/midi_arch.html">MIDI Architecture</a></li>
              <li><a href="../../audio/midi_test.html">MIDI Test Procedure</a></li>
            </ul>
          <li><a href="../../audio/usb.html">USB Digital Audio</a></li>
          <li><a href="../../audio/tv.html">TV Audio</a></li>
        </ul>
      </li>
      <li><a href="../../automotive.html">Automotive</a></li>
      <li><a href="../../bluetooth.html">Bluetooth</a></li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../camera/index.html">
            <span class="en">Camera</span>
          </a>
        </div>
        <ul>
          <li><a href="../../camera/camera3.html">Camera HAL3</a></li>
          <li><a href="../../camera/camera3_requests_hal.html">HAL Subsystem</a></li>
          <li><a href="../../camera/camera3_metadata.html">Metadata and Controls</a></li>
          <li><a href="../../camera/camera3_3Amodes.html">3A Modes and State</a></li>
          <li><a href="../../camera/camera3_crop_reprocess.html">Output and Cropping</a></li>
          <li><a href="../../camera/camera3_error_stream.html">Errors and Streams</a></li>
          <li><a href="../../camera/camera3_requests_methods.html">Request Creation</a></li>
          <li><a href="../../camera/versioning.html">Version Support</a></li>
        </ul>
      </li>

      <li><a href="../../drm.html">DRM</a></li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../graphics/index.html">
            <span class="en">Graphics</span>
          </a>
        </div>
        <ul>
         <li class="nav-section">
            <div class="nav-section-header">
              <a href="../../graphics/architecture.html">
                <span class="en">Architecture</span>
              </a>
            </div>
            <ul>
              <li><a href="../../graphics/arch-bq-gralloc.html">BufferQueue</a></li>
              <li><a href="../../graphics/arch-sf-hwc.html">SurfaceFlinger and HWC</a></li>
              <li><a href="../../graphics/arch-sh.html">Surface and SurfaceHolder</a></li>
              <li><a href="../../graphics/arch-egl-opengl.html">OpenGL ES</a></li>
              <li><a href="../../graphics/arch-vulkan.html">Vulkan</a></li>
              <li><a href="../../graphics/arch-sv-glsv.html">SurfaceView</a></li>
              <li><a href="../../graphics/arch-st.html">SurfaceTexture</a></li>
              <li><a href="../../graphics/arch-tv.html">TextureView</a></li>
              <li><a href="../../graphics/arch-gameloops.html">Game Loops</a></li>
            </ul>
         </li>
         <li class="nav-section">
            <div class="nav-section-header">
              <a href="../../graphics/implement.html">
                <span class="en">Implementing</span>
              </a>
            </div>
            <ul>
              <li><a href="../../graphics/implement-hwc.html">Hardware Composer HAL</a></li>
              <li><a href="../../graphics/implement-vsync.html">VSYNC</a></li>
              <li><a href="../../graphics/implement-vulkan.html">Vulkan</a></li>
              <li><a href="../../graphics/implement-vdisplays.html">Virtual Displays</a></li>
            </ul>
         </li>
         <li class="nav-section">
            <div class="nav-section-header">
              <a href="../../graphics/testing.html">
                <span class="en">OpenGL ES Testing</span>
              </a>
            </div>
            <ul>
              <li><a href="../../graphics/build-tests.html">Building test programs</a></li>
              <li><a href="../../graphics/port-tests.html">Porting the test framework</a></li>
              <li><a href="../../graphics/run-tests.html">Running the tests</a></li>
              <li><a href="../../graphics/automate-tests.html">Automating the tests</a></li>
              <li><a href="../../graphics/test-groups.html">Using special test groups</a></li>
              <li><a href="../../graphics/cts-integration.html">Integrating with Android CTS</a></li>
            </ul>
         </li>
        </ul> </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../input/index.html">
            <span class="en">Input</span>
          </a>
        </div>
        <ul>
          <li><a href="../../input/overview.html">Overview</a></li>
          <li><a href="../../input/key-layout-files.html">Key Layout Files</a></li>
          <li><a href="../../input/key-character-map-files.html">Key Character Map Files</a></li>
          <li><a href="../../input/input-device-configuration-files.html">Input Device Configuration Files</a></li>
          <li><a href="../../input/migration-guide.html">Migration Guide</a></li>
          <li><a href="../../input/keyboard-devices.html">Keyboard Devices</a></li>
          <li><a href="../input/touch-devices.html">Touch Devices</a></li>
          <li><a href="../input/dumpsys.html">Diagnostics</a></li>
          <li><a href="../../input/getevent.html">Getevent</a></li>
          <li><a href="../../input/validate-keymaps.html">Validate Keymaps</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../media.html">
            <span class="en">Media</span>
          </a>
        </div>
        <ul>
          <li><a href="../../media/framework-hardening.html">Framework
          Hardening</a></li>
          <li><a href="../../media/soc.html">SoC Dependencies</a></li>
          <li><a href="../../media/oem.html">OEM Dependencies</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../sensors/index.html">
            <span class="en">Sensors</span>
          </a>
        </div>
        <ul>
          <li><a href="../../sensors/sensor-stack.html">Sensor stack</a></li>
          <li><a href="../../sensors/report-modes.html">Reporting modes</a></li>
          <li><a href="../../sensors/suspend-mode.html">Suspend mode</a></li>
          <li><a href="../../sensors/power-use.html">Power consumption</a></li>
          <li><a href="../../sensors/interaction.html">Interaction</span></a></li>
          <li><a href="../../sensors/hal-interface.html">HAL interface</a></li>
          <li><a href="../../sensors/batching.html">Batching</a></li>
          <li><a href="../../sensors/sensor-types.html">Sensor types</a></li>
          <li><a href="../../sensors/versioning.html">Version deprecation</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="https://source.android.com/devices/storage/index.html">
            <span class="en">Storage</span>
          </a>
        </div>
        <ul>
          <li><a href="../../storage/traditional.html">Traditional Storage</a></li>
          <li><a href="../../storage/adoptable.html">Adoptable Storage</a></li>
          <li><a href="../../storage/config.html">Device Configuration</a></li>
          <li><a href="../../storage/config-example.html">Configuration Examples</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../tv/index.html">
            <span class="en">TV</span>
          </a>
        </div>
        <ul>
          <li><a href="../../tv/HDMI-CEC.html">HDMI-CEC control service</a></li>
          <li><a href="../../tv/reference-tv-app.html">Reference TV App</a></li>
        </ul>
      </li>
    </ul>
  </li> <!-- End nav-section, Device Interfaces-->


  <li class="nav-section"> <!--Begin nav-section, Core Technologies-->
    <div class="nav-section-header">
      <a href="../index.html">
        <span class="en">Core Technologies</span>
      </a>
    </div>

    <ul>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="index.html">
          <span class="en">ART and Dalvik</span></a>
        </div>
        <ul>
          <li><a href="dalvik-bytecode.html">Bytecode Format</a></li>
          <li><a href="dex-format.html">.Dex Format</a></li>
          <li><a href="instruction-formats.html">Instruction Formats</a></li>
          <li><a href="constraints.html">Constraints</a></li>
          <li><a href="configure.html">Configuration</a></li>
          <li><a href="gc-debug.html">Garbage Collection</a></li>
          <li><a href="jit-compiler.html">JIT Compilation</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../config/index.html">
              <span class="en">Configuration</span>
            </a>
        </div>
        <ul>
          <li><a href="../config/carrier.html">Carrier Customization</a></li>
          <li><a href="../config/connect_tests.html">Connectivity Tests</a></li>
          <li><a href="../config/filesystem.html">File System</a></li>
          <li><a href="../kernel.html">Kernel Configuration</a></li>
          <li><a href="../config/kernel_network_tests.html">Kernel Network Tests</a></li>
          <li><a href="../config/low-ram.html">Low RAM</a></li>
          <li><a href="../config/namespaces_libraries.html">Namespaces for Libraries</a></li>
          <li><a href="../config/renderer.html">OpenGLRenderer</a></li>
          <li><a href="../config/runtime_perms.html">Runtime Permissions</a></li>
          <li><a href="../config/uicc.html">UICC</a></li>
          <li><a href="../config/voicemail.html">Visual Voicemail</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../connect/index.html">
              <span class="en">Connectivity</span>
            </a>
        </div>
        <ul>
          <li><a href="../connect/block-numbers.html">Block Phone Numbers</a></li>
          <li><a href="../connect/call-notification.html">Call Notifications</a></li>
          <li><a href="../connect/data-saver.html">Data Saver Mode</a></li>
          <li><a href="../connect/emergency-affordance.html">Emergency Affordance</a></li>
          <li><a href="../connect/felica.html">Host Card Emulation of FeliCa</a></li>
          <li><a href="../connect/ril.html">Radio Interface Layer (RIL)</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../datausage/index.html">
            <span class="en">Data Usage</span>
          </a>
        </div>
        <ul>
          <li><a href="../datausage/iface-overview.html">Network interface statistics overview</a></li>
          <li><a href="../datausage/excluding-network-types.html">Excluding Network Types from Data Usage</a></li>
          <li><a href="../datausage/tethering-data.html">Tethering Data</a></li>
          <li><a href="../datausage/usage-cycle-resets-dates.html">Usage Cycle Reset Dates</a></li>
          <li><a href="../datausage/kernel-overview.html">Kernel Overview</a></li>
          <li><a href="../datausage/tags-explained.html">Data Usage Tags Explained</a></li>
          <li><a href="../datausage/kernel-changes.html">Kernel Changes</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../debug/index.html">
            <span class="en">Debugging</span>
          </a>
        </div>
        <ul>
          <li><a href="../debug/asan.html">AddressSanitizer</a></li>
          <li><a href="../debug/dumpsys.html">Dumpsys</a></li>
          <li><a href="../debug/native-memory.html">Native Memory Use</a></li>
          <li><a href="../debug/netstats.html">Network Use</a></li>
          <li><a href="../debug/procstats.html">RAM Use</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../admin/index.html">
          <span class="en">Device Administration</span></a>
        </div>
        <ul>
          <li><a href="../admin/implement.html">Implementation</a></li>
          <li><a href="../admin/multi-user.html">Multiple Users</a></li>
          <li><a href="../admin/managed-profiles.html">Managed Profiles</a></li>
          <li><a href="../admin/provision.html">Provisioning</a></li>
          <li><a href="../admin/multiuser-apps.html">Multiuser Apps</a></li>
          <li><a href="../admin/enterprise-telephony.html">Enterprise Telephony</a></li>
          <li><a href="../admin/testing-provision.html">Testing Device Provisioning</a></li>
          <li><a href="../admin/testing-setup.html">Testing Device Administration</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../display/index.html">
              <span class="en">Display Settings</span></a>
        </div>
        <ul>
          <li><a href="../display/dnd.html">Do Not Disturb</a></li>
          <li><a href="../display/multi-window.html">Multi-Window</a></li>
          <li><a href="../display/hdr.html">HDR Video</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header empty">
          <a href="../../halref/index.html">
            <span class="en">HAL File Reference</span>
          </a>
        </div>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
            <a href="../ota/index.html">
              <span class="en">OTA Updates</span>
            </a>
        </div>
        <ul>
          <li><a href="../ota/tools.html">OTA Tools</a></li>
          <li><a href="../ota/block.html">Block-based OTA</a></li>
          <li><a href="../ota/inside_packages.html">Inside OTA Packages</a></li>
          <li><a href="../ota/device_code.html">Device-Specific Code</a></li>
          <li><a href="../ota/reduce_size.html">Reducing OTA Size</a></li>
          <li><a href="../ota/sign_builds.html">Signing Builds for Release</a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../power/index.html"><span class="en">Power</span></a>
        </div>
        <ul>
          <li><a href="../power/mgmt.html">Power Management</a></li>
          <li><a href="../power/performance.html">Performance Management</a></li>
          <li><a href="../power/component.html">Component Power</a></li>
          <li><a href="../power/device.html">Device Power</a></li>
          <li><a href="../power/values.html">Power Values</a></li>
          <li><a href="../power/batterystats.html">Battery Use</a>
          </li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../test_infra/tradefed/index.html">
            <span class="en">Testing Infrastructure</span>
          </a>
        </div>
        <ul>
          <li><a href="../test_infra/tradefed/fundamentals/index.html">Start Here</a></li>
          <li><a href="../test_infra/tradefed/fundamentals/machine_setup.html">Machine Setup</a></li>
          <li><a href="../test_infra/tradefed/fundamentals/devices.html">Working with Devices</a></li>
          <li><a href="../test_infra/tradefed/fundamentals/lifecycle.html">Test Lifecycle</a></li>
          <li><a href="../test_infra/tradefed/fundamentals/options.html">Option Handling</a></li>
          <li><a href="../test_infra/tradefed/full_example.html">An End-to-End Example</a></li>
          <li id="tradefed-tree-list" class="nav-section">
            <div class="nav-section-header">
              <a href="../../../reference/packages.html">
                <span class="en">Package Index</span>
              </a>
            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li> <!-- End nav-section, Core Technologies -->
</ul> 


      </div>
      <script type="text/javascript">
        showTradefedRefTree();
      </script>
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>

  




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >Implementing ART Just-In-Time (JIT) Compiler</h1>
      
    
  


  
  <div id="jd-content">

    <div class="jd-descr" itemprop="articleBody">
    <!--
    Copyright 2016 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->


<div id="qv-wrapper">
<div id="qv">
  <h2 id="Contents">In this document</h2>
  <ol id="auto-toc">
  </ol>
</div>
</div>

<p>
Android 7.0 adds a just-in-time (JIT) compiler with code profiling to Android
runtime (ART) that constantly improves the performance of Android apps as they
run. The JIT compiler complements ART's current ahead-of-time (AOT) compiler and
improves runtime performance, saves storage space, and speeds app updates and
system updates.
</p>

<p>
The JIT compiler also improves upon the AOT compiler by avoiding system slowdown
during automatic application updates or recompilation of applications during
OTAs. This feature should require minimal device integration on the part of
manufacturers.
</p>

<p>
JIT and AOT use the same compiler with an almost identical set of optimizations.
The generated code might not be the same but it depends. JIT makes uses of
runtime type information and can do better inlining. Also, with JIT we sometimes
do OSR compilation (on stack replacement) which will again generate a bit
different code.
</p>

<p>
See <a
href="https://developer.android.com/preview/api-overview.html#jit_aot">Profile-guided
JIT/AOT Compilation</a> on developer.android.com for a more thorough overview.
</p>

<h2 id="architectural-overview">Architectural Overview</h2>

<img src="images/jit-arch.png" alt="JIT architecture" width="633" id="JIT-architecture" />
<p class="img-caption">
  <strong>Figure 1.</strong> JIT architecture - how it works
</p>

<h2 id="flow">Flow</h2>

<p>
JIT compilation works in this manner:
</p>

<ol>
<li>The user runs the app, which then triggers ART to load the .dex file.
<li>If the .oat file (the AOT binary for the .dex file) is available, ART uses
them directly. Note that .oat files are generated regularly. However, that does
not imply they contain compiled code (AOT binary).
<li>If no .oat file is available, ART runs through either JIT or an interpreter
to execute the .dex file. ART will always use the .oat files if available.
Otherwise, it will use the APK and extract it in memory to get to the .dex
incurring a big memory overhead (equal to the size of the dex files).
<li>JIT is enabled for any application that is not compiled according to the
"speed" compilation filter (which says, compile as much as you can from the
app).
<li>The JIT profile data is dumped to a file in a system directory. Only the
application has access to the directory.
<li>The AOT compilation (dex2oat) daemon parses that file to drive its
compilation.</li>
</ol>

<img src="images/jit-profile-comp.png" alt="Profile-guided comp" width="452" id="JIT-profile-comp" />
<p class="img-caption">
  <strong>Figure 2.</strong> Profile-guided compilation
</p>

<img src="images/jit-daemon.png" alt="JIT daemon" width="718" id="JIT-daemon" />
<p class="img-caption">
  <strong>Figure 3.</strong> How the daemon works
</p>

<p>
The Google Play service is an example used by other apps. These application tend
to behave more like shared libraries.
</p>

<h2 id="jit-workflow">JIT Workflow</h2>
<p>
See the following high-level overview of how JIT works in the next diagram.
</p>

<img src="images/jit-workflow.png" alt="JIT architecture" width="707" id="JIT-workflow" />
<p class="img-caption">
  <strong>Figure 4.</strong> JIT data flow
</p>

<p>
This means:
</p>

<ul>
<li>Profiling information is stored in the code cache and subjected to garbage
collection under memory pressure.
<li>As a result, thereâ€™s no guarantee the snapshot taken when the application is
in the background will contain the complete data (i.e. everything that was
JITed).
<li>There is no attempt to make sure we record everything as that will impact
runtime performance.
<li>Methods can be in three different states: <ul>
 <li>interpreted (dex code)
 <li>JIT compiled
 <li>AOT compiled
<li>If both, JIT and AOT code exists (e.g. due to repeated de-optimizations),
the JITed code will be preferred.
<li>The memory requirement to run JIT without impacting foreground app
performance depends upon the app in question. Large apps will require more
memory than small apps. In general, big apps stabilize around 4 MB.</li></ul>
</li>
</ul>

<h2 id="system-properties">System Properties</h2>

<p>
These system properties control JIT behavior:
</p><ul>
<li><code>dalvik.vm.usejit <true|false></code> - Whether or not the JIT is
enabled.
<li><code>dalvik.vm.jitinitialsize</code> (default 64K) - The initial capacity
of the code cache. The code cache will regularly GC and increase if needed. It
is possible to view the size of the code cache for your app with:<br>
<code> $ adb shell dumpsys meminfo -d &LT;pid&GT;</code>
<li><code>dalvik.vm.jitmaxsize</code> (default 64M) - The maximum capacity of
the code cache.
<li><code>dalvik.vm.jitthreshold &LT;integer&GT;</code> (default 10000) - This
is the threshold that the "hotness" counter of a method needs to pass in order
for the method to be JIT compiled. The "hotness" counter is a metric internal
to the runtime. It includes the number of calls, backward branches & other
factors.
<li><code>dalvik.vm.usejitprofiles &LT;true|false&GT;</code> - Whether or not
JIT profiles are enabled;  this may be used even if usejit is false.
<li><code>dalvik.vm.jitprithreadweight &LT;integer&GT;</code> (default to
<code>dalvik.vm.jitthreshold</code> / 20) - The weight of the JIT "samples"
(see jitthreshold) for the application UI thread. Use to speed up compilation
of methods that directly affect users experience when interacting with the
app.
<li><code>dalvik.vm.jittransitionweight &LT;integer&GT;</code>
(<code>dalvik.vm.jitthreshold</code> / 10) - The weight of the method
invocation that transitions between compile code and interpreter. This helps
make sure the methods involved are compiled to minimize transitions (which are
expensive).
</li>
</ul>

<h2 id="tuning">Tuning</h2>

<p>
Device implementers may precompile (some of) the system apps if they want so.
Initial JIT performance vs pre-compiled depends on the the app, but in general
they are quite close. It might be worth noting that precompiled apps will not
be profiled and as such will take more space and may miss on other
optimizations.
</p>

<p>
In Android 7.0, there's a generic way to specify the level of
compilation/verification based on the different use cases. For example, the
default option for install time is to do only verification (and postpone
compilation to a later stage). The compilation levels can be configured via
system properties with the defaults being:
</p>

<pre>
pm.dexopt.install=interpret-only
pm.dexopt.bg-dexopt=speed-profile
pm.dexopt.ab-ota=speed-profile
pm.dexopt.nsys-library=speed
pm.dexopt.shared-apk=speed
pm.dexopt.forced-dexopt=speed
pm.dexopt.core-app=speed
pm.dexopt.first-boot=interpret-only
pm.dexopt.boot=verify-profile
</pre>

<p>
See the <a href="jit-compiler.html#recommendation">Recommendation</a> section for use.
</p>

<p>
Note the reference to A/B over-the-air (OTA) updates here.
</p>

<p>
Check <code>$ adb shell cmd package compile</code> for usage. Note all commands
in this document are preceded by a dollar ($) sign that should be excluded when
copying and pasting. A few common use cases:
</p>

<h3 id="turn-on-jit-logging">Turn on JIT logging</h3>

<pre>
$ adb root
$ adb shell stop
$ adb shell setprop dalvik.vm.extra-opts -verbose:jit
$ adb shell start
</pre>

<h3 id="disable-jit-and-run-applications-in-interpreter">Disable JIT</h3>

<pre>
$ adb root
$ adb shell stop
$ adb shell setprop dalvik.vm.usejit false
$ adb shell start
</pre>

<h3 id="force-compilation-of-a-specific-package">Force compilation of a specific
package</h3>

<ul>
<li>Profile-based:
<code>$ adb shell cmd package compile -m speed-profile -f
my-package</code>
<li>Full:
<code>$ adb shell cmd package compile -m speed -f
my-package</code></li>
</ul>

<h3 id="force-compilation-of-all-packages">Force compilation of all
packages</h3>

<ul>
<li>Profile-based:
<code>$ adb shell cmd package compile -m speed-profile -f
-a</code>
<li>Full:
<code>$ adb shell cmd package compile -m speed -f -a</code></li></ul>

<h3 id="clear-profile-data-and-remove-compiled-code">Clear profile data and
remove compiled code</h3>

<ul>
<li>One package:
<code>$ adb shell cmd package compile --reset my-package</code>
<li>All packages
<code>$ adb shell cmd package compile --reset
-a</code></li>
</ul>

<h2 id="recommendation">Recommendation</h2>

<h3 id="runtime_compilation_level">Level of compilation/verification</h3>

<p>
Note that it is strongly recommended to use the default following
<code>pm.dexopt</code> settings and it is the only path we have tested and will
support.
</p>

<pre>
pm.dexopt.install=interpret-only
pm.dexopt.bg-dexopt=speed-profile
pm.dexopt.boot=verify-profile (or interpret-only)
</pre>

<p>
Hereâ€™s a detailed explanation about the <code>pm.dexopt</code> options, and the
reasoning for our recommendations:
</p>

<pre>
pm.dexopt.install
</pre>

<p>
This is the compilation filter used when installing application through the
Play Store. For faster installs we recommend <code>interpret-only</code>.
</p>

<pre>
pm.dexopt.bg-dexopt
</pre>

<p>
This is the compilation filter used when the device is idle and charging and
fully charged.  We recommend using <code>speed-profile</code> to take advantage
of profile guided compilation and save on storage.
</p>

<pre>
pm.dexopt.ab-ota
</pre>

<p>
This is the compilation filter used when doing an A/B over-the-air (OTA)
update. If the device supports A/B OTA,  we recommend using
<code>speed-profile</code> to take advantage of profile guided compilation and
save on storage.
</p>

<pre>
pm.dexopt.nsys-library
pm.dexopt.shared-apk
pm.dexopt.core-app
</pre>

<p>
You can use these different options to control how to compile essentially
applications used by other applications. For such applications, we recommend
the <code>speed</code> filter, as the platform does not support efficient
profiling of them.
</p>

<pre>
pm.dexopt.first-boot
</pre>

<p>
The compilation filter for the first time the device ever boots. The filter
used here will only affect the boot time after factory. We recommend the filter
<code>interpret-only</code> for it, to avoid long times before a user gets to
use the phone for the very first time. Note that if all applications in /system
are already speed compiled, <code>pm.dexopt.first-boot</code> has no effect.
</p>

<pre>
pm.dexopt.boot
</pre>

<p>
The compilation filter used after an over-the-air update. We
<strong>strongly</strong> recommend <code>verify-profile</code> for this
option, to avoid very long updates.
</p>

<h3 id="system_image_compilation_level">System image</h3>

<p>
This section gives recommendations on how to minimize the system image size
while retaining the highest possible level of performance.
Note these complement the above guidelines on the
<a href="jit-compiler.html#runtime_compilation_level">level of compilation/verification</a>.
</p>

<p>
System image size can be reduced by opting for a lower level of compilation for
prebuilts. To achieve the best compromise between app performance and image size,
we strongly recommend compiling prebuilts with the <code>interpret-only</code>
filter. To do this, edit the following files to include these entries.
</p>

<p>Add the following entry to <code>BoardConfig.mk</code>:</p>

<pre>WITH_DEXPREOPT := true</pre>

<p>Add the following entry to <code>device.mk</code>:</p>

<pre>
PRODUCT_DEX_PREOPT_DEFAULT_FLAGS := --compiler-filter=interpret-only
</pre>

<p>
Using the <code>interpret-only</code> filter will reduce the optimized code
size for prebuilts by roughly half (depending on the the application) when
compared with the <code>speed</code> filter. It also allows the runtime to
profile the prebuilts and perform profile-guided compilation to further
save on data partition storage.
</p>

<p>
We advise against using a lower compilation/verification level
(e.g. <code>verify-none</code>) or disabling the optimization for prebuilts
as an effort to further save space on the system image. That will lead to slower
application startup and increased memory consumption.
</p>

<h2 id="validation">Validation</h2>

<p>
To ensure their version of the feature works as intended, device implementers
should run the ART test in <code>android/art/test</code>. Also, see the CTS
test <code>hostsidetests/compilation</code> for userdedug builds.
</p>

    </div>

      <div class="content-footer-sac"
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-9" style="padding-top:4px">
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
    </div> <!-- end jd-content -->
  <div id="footer" class="wrap" >
  <style>.feedback { float: right !Important }</style>
  <div class="feedback">
    <a href="jit-compiler.html#" class="button" onclick=" try {
      userfeedback.api.startFeedback({'productId':'715571','authuser':'1'});return false;}catch(e){}">Site Feedback</a>
  </div>
  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../../license.html">Content 
  License</a>.
  </div>
    <div id="footerlinks">
    
  <p>
    <a href="../../../source/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../../source/community.html">Community</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
  </p>
  </div>

</div><!-- end doc-content -->

</div> <!-- end body-content --> 






</body>
</html>



