<!DOCTYPE html>











































































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="Description" content="If a device has a fingerprint sensor, a user can enroll one or more fingerprints and then use their fingerprints to unlock the device and perform other tasks. Android uses the Fingerprint Hardware Abstraction Layer (HAL) to connect to a vendor-specificâ€¦">

<link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.ico" />
<title>Fingerprint HAL | Android Open Source Project</title>

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../../../assets/css/default.css" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "/";
  
  var devsite = false;
  
</script>
<script src="../../../../assets/js/docs.js" type="text/javascript"></script>


<script type="text/javascript" src="https://www.gstatic.com/feedback/api.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45455297-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body class="gc-documentation 
  " itemscope itemtype="http://schema.org/Article">
<a name="top"></a>

  
    <!-- Header -->
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 saclogo">
          <a href="../../../../index.html">
            <img src="../../../../assets/images/sac_logo.png"
                srcset="/assets/images/sac_logo@2x.png 2x"
                width="123" height="25" alt="Android Open Source Project" />
          </a>
          </div>
            <ul class="nav-x col-9">
                <li class="source">
                  <a href="../../../../source/index.html" 
                  >Source</a></li>
                <li class="devices"><a href="../../../index.html" 
                  >Devices</a></li>
                <li class="security"><a href="../../../../security/index.html" class="selected"
                  >Security</a></li>
                <li class="compatibility last"><a href="../../../../compatibility/index.html" 
                  >Compatibility</a></li>
            </ul>
            <!-- New Search -->
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Android Sites</div>
      <ul>
        <li class="active"><a>Android Open Source Project</a></li>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li><a href="http://developer.android.com">Android Developers</a></li>
      </ul>
      <!-- <div class="header">Support</div>
      <ul>
        <li><a href="/support.html">Developer Support</a></li>
      </ul> -->
      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>

  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '/')"
onkeyup="return search_changed(event, false, '/')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>
  <div id="search_filtered_wrapper">
    <div id="search_filtered_div" class="no-display">
        <ul id="search_filtered">
        </ul>
    </div>
  </div>

  </div>
  <!-- /New Search> -->
        </div>
    </div>
    <!-- /Header -->

  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div>

  
  
  
    
  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="fingerprint-hal.html#top" data-g-event="left-nav-top">to top</a>

<!--
    Copyright 2015 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<ul id="nav">
  <li class="nav-section">
    <div class="nav-section-header">
        <a href="../../../../security/index.html">
          <span class="en">Overview</span>
        </a>
    </div>
    <ul>
      <li><a href="../../../../security/overview/kernel-security.html">Kernel Security</a></li>
      <li><a href="../../../../security/overview/app-security.html">App Security</a></li>
      <li><a href="../../../../security/overview/implement.html">Implementing Security</a></li>
      <li><a href="../../../../security/overview/updates-resources.html">Updates and Resources</a></li>
      <li class="nav-section">
        <div class="nav-section-header">
          <a href="../../../../security/enhancements/index.html">
            <span class="en">Enhancements</span>
          </a>
        </div>
        <ul>
          <li><a href="../../../../security/enhancements/enhancements70.html">Android 7.0</a></li>
          <li><a href="../../../../security/enhancements/enhancements60.html">Android 6.0</a></li>
          <li><a href="../../../../security/enhancements/enhancements50.html">Android 5.0</a></li>
          <li><a href="../../../../security/enhancements/enhancements44.html">Android 4.4</a></li>
          <li><a href="../../../../security/enhancements/enhancements43.html">Android 4.3</a></li>
          <li><a href="../../../../security/enhancements/enhancements42.html">Android 4.2</a></li>
          <li><a href="../../../../security/enhancements/enhancements41.html">Android 4.1</a></li>
        </ul>
      </li>
      <li><a href="../../../../security/overview/acknowledgements.html">Acknowledgements</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../../../security/bulletin/index.html">
        <span class="en">Bulletins</span>
      </a>
    </div>
    <ul>
      <li class="nav-section">
         <div class="nav-section-header">
           <a href="../../../../security/advisory/index.html">
         <span class="en">Advisories</span>
        </a>
       </div>
         <ul>
           <li><a href="../../../../security/advisory/2016-03-18.html">2016-03-18</a></li>
         </ul>
      </li>
      <li><a href="../../../../security/bulletin/2016-08-01.html">August 2016</a></li>
      <li><a href="../../../../security/bulletin/2016-07-01.html">July 2016</a></li>
      <li><a href="../../../../security/bulletin/2016-06-01.html">June 2016</a></li>
      <li><a href="../../../../security/bulletin/2016-05-01.html">May 2016</a></li>
      <li><a href="../../../../security/bulletin/2016-04-02.html">April 2016</a></li>
      <li><a href="../../../../security/bulletin/2016-03-01.html">March 2016</a></li>
      <li><a href="../../../../security/bulletin/2016-02-01.html">February 2016</a></li>
      <li><a href="../../../../security/bulletin/2016-01-01.html">January 2016</a></li>
      <li class="nav-section">
         <div class="nav-section-header">
           <a href="../../../../security/bulletin/2015.html">
         <span class="en">2015 Bulletins</span>
        </a>
       </div>
         <ul>
           <li><a href="../../../../security/bulletin/2015-12-01.html">December 2015</a></li>
           <li><a href="../../../../security/bulletin/2015-11-01.html">November 2015</a></li>
           <li><a href="../../../../security/bulletin/2015-10-01.html">October 2015</a></li>
           <li><a href="../../../../security/bulletin/2015-09-01.html">September 2015</a></li>
           <li><a href="../../../../security/bulletin/2015-08-01.html">August 2015</a></li>
         </ul>
      </li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../../../security/apksigning/index.html">
        <span class="en">Application Signing</span>
      </a>
    </div>
    <ul>
      <li><a href="../../../../security/apksigning/v2.html">APK Signature Scheme v2</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../../../security/authentication/index.html">
        <span class="en">Authentication</span>
      </a>
    </div>
    <ul>
      <li><a href="fingerprint-hal.html">Fingerprint HAL</a></li>
      <li><a href="gatekeeper.html">Gatekeeper</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../../../security/keystore/index.html">
        <span class="en">Keystore</span>
      </a>
    </div>
    <ul>
      <li><a href="../../../../security/keystore/features.html">Features</a></li>
      <li><a href="../../../../security/keystore/implementer-ref.html">Implementer's Reference</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../../../security/trusty/index.html">
        <span class="en">Trusty TEE</span>
      </a>
    </div>
    <ul>
      <li><a href="../../../../security/trusty/trusty-ref.html">Trusty API Reference</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../encryption/index.html">
        <span class="en">Encryption</span>
      </a>
    </div>
    <ul>
      <li><a href="../../../../security/encryption/file-based.html">File-Based Encryption</a></li>
      <li><a href="../../../../security/encryption/full-disk.html">Full-Disk Encryption</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../selinux/index.html">
        <span class="en">SELinux</span>
      </a>
    </div>
    <ul>
      <li><a href="../../../../security/selinux/concepts.html">Concepts</a></li>
      <li><a href="../../../../security/selinux/implement.html">Implementation</a></li>
      <li><a href="../../../../security/selinux/customize.html">Customization</a></li>
      <li><a href="../../../../security/selinux/validate.html">Validation</a></li>
      <li><a href="../../../../security/selinux/device-policy.html">Writing Policy</a></li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header">
      <a href="../../../../security/verifiedboot/index.html">
        <span class="en">Verified Boot</span>
      </a>
    </div>
    <ul>
      <li><a href="../../../../security/verifiedboot/verified-boot.html">Verifying Boot</a></li>
      <li><a href="../../../../security/verifiedboot/dm-verity.html">Implementing dm-verity</a></li>
    </ul>
  </li>
</ul>


      </div>
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>

  




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >Fingerprint HAL</h1>
      
    
  


  
  <div id="jd-content">

    <div class="jd-descr" itemprop="articleBody">
    <!--
    Copyright 2015 The Android Open Source Project

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<div id="qv-wrapper">
  <div id="qv">
    <h2>In this document</h2>
    <ol id="auto-toc">
    </ol>
  </div>
</div>

<h2 id=overview>Overview</h2>

<p>If a device has a fingerprint sensor, a user can enroll one or more
fingerprints and then use their fingerprints to unlock the device and perform
other tasks.</p>

<p>Android uses the Fingerprint Hardware Abstraction Layer (HAL) to connect to a
vendor-specific library and fingerprint hardware, e.g. a fingerprint sensor.</p>

<p>To implement the Fingerprint HAL, you must implement
<a href="fingerprint-hal.html#major_functions_in_the_fingerprint_hal">functions</a>
in <code>fingerprint.h</code> (<code>/hardware/libhardware/include/hardware/fingerprint.h</code>)
in a vendor-specific library; please see the comments in
the <a href="https://android.googlesource.com/platform/hardware/libhardware/+/master/include/hardware/fingerprint.h"><code>fingerprint.h</code></a> file.</p>

<h3 id=fingerprint_matching_flow>Fingerprint matching flow</h3>

<p>The following is a high-level flow for fingerprint matching. This flow assumes
that a fingerprint already has been enrolled on the device, i.e. the
vendor-specific library already has enrolled a template for the fingerprint.
Also see <a href="../../../../security/authentication/index.html">Authentication</a>.</p>

<p>The fingerprint sensor of a device generally is idle. But in response to a call
to the <code>authenticate</code> or <code>enroll</code> function, the fingerprint
sensor listens for a touch (and perhaps the screen
wakes up when a user touches the fingerprint sensor).</p>

<ol>
  <li>The user places a finger on the fingerprint sensor, and the vendor-specific
library determines if there is a match based on the current set of enrolled
templates.
  <li>The result of step 1 is passed to the Fingerprint HAL, which notifies
<code>fingerprintd</code> (the Fingerprint daemon) of a fingerprint authentication.
</ol>

<p>Note that as more templates are stored on a single device, the time needed for
matching is increased.</p>

<h2 id=architecture>Architecture</h2>

<p>The <strong>Fingerprint HAL</strong> interacts with the following components:</p>

<ul>
  <li><strong>FingerprintManager API</strong>. Interacts directly with an app in an app process.
  <ul>
    <li>Each app has an instance of FingerprintManager.
    <li>FingerprintManager is a wrapper that communicates with FingerprintService.
  </ul>
  <li><strong>FingerprintService</strong>. A singleton service that operates in the system
  process, which handles
communication with <code>fingerprintd</code>.
  <li><strong>fingerprintd (Fingerprint daemon)</strong>. A C/C++ implementation of the
  binder interface from FingerprintService. The
<code>fingerprintd</code> daemon operates in its own process and wraps the Fingerprint HAL
vendor-specific library.
  <li><strong>Fingerprint HAL vendor-specific library</strong>. A hardware vendor's
  implementation of the Fingerprint HAL. The
vendor-specific library communicates with the device-specific hardware.
  <li><strong>Keystore API and Keymaster</strong>. These components provide hardware-backed cryptography
  for secure key storage
  in a Trusted Execution Environment (TEE).
</ul>

<p>As shown in the following diagram, a vendor-specific HAL implementation needs
to use the communication protocol required by a TEE.</p>

<img src="../../../../security/images/fingerprint-data-flow.png" alt="Data flow for fingerprint authentication" id="figure1" />

<p class="img-caption"><strong>Figure 1.</strong> High-level data flow for fingerprint authentication</p>

<p>Thus, raw images and processed fingerprint features must not be passed in
untrusted memory. All such biometric data needs to be secured within sensor
hardware or trusted memory. (Memory inside the TEE is considered as trusted
memory; memory outside the TEE is considered untrusted.)</p>

<p>Rooting must not compromise biometric data.</p>

<p>As shown in the following diagram, <code>fingerprintd</code> makes calls through the
Fingerprint HAL to the vendor-specific library to enroll fingerprints and
perform other operations.</p>

<img src="../../../../security/images/fingerprint-daemon.png" alt="Interaction with fingerprintd" id="figure2" />
<p class="img-caption"><strong>Figure 2.</strong> Interaction of the
fingerprint daemon (<code>fingerprintd</code>) with the fingerprint vendor-specific library</p>

<h2 id=fingerprint_implementation_guidelines>Fingerprint implementation guidelines</h2>

<p>The guidelines in this section are intended to ensure the following:</p>

<ul>
  <li>Fingerprint data is not leaked
  <li>Fingerprint data is removed when a user is removed from a device
</ul>

<p>Here are the guidelines:</p>

<ol>
  <li>Raw fingerprint data or derivatives (e.g. templates) must never be accessible
from outside the sensor driver or Trusted Execution Environment (TEE). Hardware
access must be limited to the TEE, if the hardware supports it, and must be protected by
an SELinux policy. That is, the Serial Peripheral Interface (SPI) channel must
be accessible only to the TEE, and there must be an explicit SELinux policy on
all device files.
  <li>Fingerprint acquisition, enrollment and recognition must occur inside the TEE.
  <li>Only the encrypted form of the fingerprint data can be stored on the file
system, even if the file system itself is encrypted.
  <li>Fingerprint templates must be signed with a private, device-specific key, for
example with AES, with at least the absolute file-system path, group and finger
ID such that template files are inoperable on another device or for anyone
other than the user that enrolled them on the same device. For example, copying
the fingerprint data from a different user on the same device, or from another
device, must not work.
  <li>Implementations must either use the file system path provided by the
  <code>set_active_group()</code> function or provide a way to erase all user template data when the user
is removed. It is strongly recommended that fingerprint template files
be stored as encrypted in the path provided. If this is infeasible due to TEE
storage requirements, then the implementer must add hooks to ensure removal of
the data when the user is removed.
</ol>

<h2 id=major_functions_in_the_fingerprint_hal>Major functions in the Fingerprint HAL</h2>

<p>Below are the major functions in the <code>/hardware/libhardware/include/hardware/fingerprint.h</code> file; see the detailed descriptions in that
file.</p>

<ul>
  <li><strong>enroll.</strong> Switches the HAL state machine to start the collection and storage of a
fingerprint template. As soon as enrollment is complete, or after a timeout,
the HAL state machine is returned to the idle state.
  <li><strong>pre_enroll.</strong> Generates a unique token to indicate the start of a fingerprint enrollment.
Provides a token to the <code>enroll</code> function to ensure there was prior authentication, e.g. using a password. The
token is wrapped and, for example, HMAC'd, once the device credential is
confirmed, to prevent tampering. The token must be checked during enrollment to
verify that the token is still valid.
  <li><strong>get_authenticator_id.</strong> Returns a token associated with the current fingerprint set.
  <li><strong>cancel.</strong> Cancels any pending enroll or authenticate operations. The HAL state machine
is returned to the idle state.
  <li><strong>enumerate.</strong> Synchronous call for enumerating all known fingerprint templates.
  <li><strong>remove.</strong> Deletes a fingerprint template.
  <li><strong>set_active_group.</strong> Restricts a HAL operation to a set of fingerprints that belong to a specified
group (identified by a group identifier, or GID).
  <li><strong>authenticate.</strong> Authenticates a fingerprint-related operation (identified by an operation ID).
  <li><strong>set_notify.</strong> Registers a user function that will get notifications from the HAL. If the HAL
state machine is in a busy state, the function is blocked until the HAL leaves
the busy state.
</ul>


    </div>

      <div class="content-footer-sac"
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-9" style="padding-top:4px">
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
    </div> <!-- end jd-content -->
  <div id="footer" class="wrap" >
  <style>.feedback { float: right !Important }</style>
  <div class="feedback">
    <a href="fingerprint-hal.html#" class="button" onclick=" try {
      userfeedback.api.startFeedback({'productId':'715571','authuser':'1'});return false;}catch(e){}">Site Feedback</a>
  </div>
  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../../../license.html">Content 
  License</a>.
  </div>
    <div id="footerlinks">
    
  <p>
    <a href="../../../../source/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../../../source/community.html">Community</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
  </p>
  </div>

</div><!-- end doc-content -->

</div> <!-- end body-content --> 






</body>
</html>



