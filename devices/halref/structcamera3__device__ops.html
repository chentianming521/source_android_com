<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Android Hardware Abstraction Layer: camera3_device_ops Struct Reference</title>
<link href="http://source.android.com/devices/halref/tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="http://www.gstatic.com/external_hosted/source_android_com/sac_doxygen_jquery.js"></script>
<script type="text/javascript" src="http://source.android.com/devices/halref/dynsections.js"></script>
<link href="http://source.android.com/devices/halref/navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="http://source.android.com/devices/halref/resize.js"></script>
<script type="text/javascript" src="http://source.android.com/devices/halref/navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="http://source.android.com/devices/halref/doxygen.css" rel="stylesheet" type="text/css" />
<link href="http://source.android.com/devices/halref/hal_doxygen.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45455297-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="header">
            <table width=80%>
              <tr>
                <td><a href="http://source.android.com/index.html"><img src="http://source.android.com/assets/images/sac_logo.png" width="123" height="25" alt="Android Developers" /></td>
                <td><a class=toptab href="http://source.android.com/source/index.html">Source</a></td>
                <td><a class=devices href="http://source.android.com/devices/index.html">Devices</a></td>
                <td><a class=toptab href="http://source.android.com/security/index.html">Security</a></td>
                <td><a class=toptab href="http://source.android.com/compatibility/index.html">Compatibility</a></td>
                <td width=20%></td>
              </tr>
            </table>
  </div>
<hr class=light>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structcamera3__device__ops.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="structcamera3__device__ops.html#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">camera3_device_ops Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a8d000d2a2a425867f83d212aa7eece27"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#a8d000d2a2a425867f83d212aa7eece27">initialize</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, const <a class="el" href="camera3_8h.html#a34ca9e651598163bb6e401d1db3da359">camera3_callback_ops_t</a> *callback_ops)</td></tr>
<tr class="separator:a8d000d2a2a425867f83d212aa7eece27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48a246bfc7ecebac9d27c58151648539"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, <a class="el" href="camera3_8h.html#a254007df9f83a010c289630ce7e38e59">camera3_stream_configuration_t</a> *stream_list)</td></tr>
<tr class="separator:a48a246bfc7ecebac9d27c58151648539"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b564eaecece3af81a5be5db1e817fb9"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#a8b564eaecece3af81a5be5db1e817fb9">register_stream_buffers</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, const <a class="el" href="camera3_8h.html#a6bf819e9c2aee2ccc9a7ea86639efb20">camera3_stream_buffer_set_t</a> *buffer_set)</td></tr>
<tr class="separator:a8b564eaecece3af81a5be5db1e817fb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2ac0e77ced61544947f40eb328ccb31"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="camera__common_8h.html#a650c3d4440786f728ec509ceb6e7a56c">camera_metadata_t</a> *(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#ab2ac0e77ced61544947f40eb328ccb31">construct_default_request_settings</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, int type)</td></tr>
<tr class="separator:ab2ac0e77ced61544947f40eb328ccb31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93ed24e27cb47f7f907c0bb56b114009"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, <a class="el" href="camera3_8h.html#afea9dcedcccdb56f68567f8c9bbb0405">camera3_capture_request_t</a> *request)</td></tr>
<tr class="separator:a93ed24e27cb47f7f907c0bb56b114009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa33d0dc56ecc55cd06f8ba64de8f3b06"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#aa33d0dc56ecc55cd06f8ba64de8f3b06">get_metadata_vendor_tag_ops</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, vendor_tag_query_ops_t *ops)</td></tr>
<tr class="separator:aa33d0dc56ecc55cd06f8ba64de8f3b06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac158a8b077d97e34e6878934594dccbb"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#ac158a8b077d97e34e6878934594dccbb">dump</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, int fd)</td></tr>
<tr class="separator:ac158a8b077d97e34e6878934594dccbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bd084c17ec0b22a60fc0f41c6626976"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush</a> )(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *)</td></tr>
<tr class="separator:a2bd084c17ec0b22a60fc0f41c6626976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ee8b7f36386fa3dd3e253feaf0931b0"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcamera3__device__ops.html#a4ee8b7f36386fa3dd3e253feaf0931b0">reserved</a> [8]</td></tr>
<tr class="separator:a4ee8b7f36386fa3dd3e253feaf0931b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02509">2509</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>
</div><h2 class="groupheader">Field Documentation</h2>
<a class="anchor" id="a48a246bfc7ecebac9d27c58151648539"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* configure_streams)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, <a class="el" href="camera3_8h.html#a254007df9f83a010c289630ce7e38e59">camera3_stream_configuration_t</a> *stream_list)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>configure_streams:</p>
<p>CAMERA_DEVICE_API_VERSION_3_0 only:</p>
<p>Reset the HAL camera device processing pipeline and set up new input and output streams. This call replaces any existing stream configuration with the streams defined in the stream_list. This method will be called at least once after <a class="el" href="structcamera3__device__ops.html#a8d000d2a2a425867f83d212aa7eece27">initialize()</a> before a request is submitted with <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a>.</p>
<p>The stream_list must contain at least one output-capable stream, and may not contain more than one input-capable stream.</p>
<p>The stream_list may contain streams that are also in the currently-active set of streams (from the previous call to configure_stream()). These streams will already have valid values for usage, max_buffers, and the private pointer.</p>
<p>If such a stream has already had its buffers registered, <a class="el" href="structcamera3__device__ops.html#a8b564eaecece3af81a5be5db1e817fb9">register_stream_buffers()</a> will not be called again for the stream, and buffers from the stream can be immediately included in input requests.</p>
<p>If the HAL needs to change the stream configuration for an existing stream due to the new configuration, it may rewrite the values of usage and/or max_buffers during the configure call.</p>
<p>The framework will detect such a change, and will then reallocate the stream buffers, and call <a class="el" href="structcamera3__device__ops.html#a8b564eaecece3af81a5be5db1e817fb9">register_stream_buffers()</a> again before using buffers from that stream in a request.</p>
<p>If a currently-active stream is not included in stream_list, the HAL may safely remove any references to that stream. It will not be reused in a later configure() call by the framework, and all the gralloc buffers for it will be freed after the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call returns.</p>
<p>The stream_list structure is owned by the framework, and may not be accessed once this call completes. The address of an individual camera3_stream_t structure will remain valid for access by the HAL until the end of the first configure_stream() call which no longer includes that camera3_stream_t in the stream_list argument. The HAL may not change values in the stream structure outside of the private pointer, except for the usage and max_buffers members during the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call itself.</p>
<p>If the stream is new, the usage, max_buffer, and private pointer fields of the stream structure will all be set to 0. The HAL device must set these fields before the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call returns. These fields are then used by the framework and the platform gralloc module to allocate the gralloc buffers for each stream.</p>
<p>Before such a new stream can have its buffers included in a capture request, the framework will call <a class="el" href="structcamera3__device__ops.html#a8b564eaecece3af81a5be5db1e817fb9">register_stream_buffers()</a> with that stream. However, the framework is not required to register buffers for <em>all</em> streams before submitting a request. This allows for quick startup of (for example) a preview stream, with allocation for other streams happening later or concurrently. </p>
<hr/>
<p> CAMERA_DEVICE_API_VERSION_3_1 only:</p>
<p>Reset the HAL camera device processing pipeline and set up new input and output streams. This call replaces any existing stream configuration with the streams defined in the stream_list. This method will be called at least once after <a class="el" href="structcamera3__device__ops.html#a8d000d2a2a425867f83d212aa7eece27">initialize()</a> before a request is submitted with <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a>.</p>
<p>The stream_list must contain at least one output-capable stream, and may not contain more than one input-capable stream.</p>
<p>The stream_list may contain streams that are also in the currently-active set of streams (from the previous call to configure_stream()). These streams will already have valid values for usage, max_buffers, and the private pointer.</p>
<p>If such a stream has already had its buffers registered, <a class="el" href="structcamera3__device__ops.html#a8b564eaecece3af81a5be5db1e817fb9">register_stream_buffers()</a> will not be called again for the stream, and buffers from the stream can be immediately included in input requests.</p>
<p>If the HAL needs to change the stream configuration for an existing stream due to the new configuration, it may rewrite the values of usage and/or max_buffers during the configure call.</p>
<p>The framework will detect such a change, and will then reallocate the stream buffers, and call <a class="el" href="structcamera3__device__ops.html#a8b564eaecece3af81a5be5db1e817fb9">register_stream_buffers()</a> again before using buffers from that stream in a request.</p>
<p>If a currently-active stream is not included in stream_list, the HAL may safely remove any references to that stream. It will not be reused in a later configure() call by the framework, and all the gralloc buffers for it will be freed after the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call returns.</p>
<p>The stream_list structure is owned by the framework, and may not be accessed once this call completes. The address of an individual camera3_stream_t structure will remain valid for access by the HAL until the end of the first configure_stream() call which no longer includes that camera3_stream_t in the stream_list argument. The HAL may not change values in the stream structure outside of the private pointer, except for the usage and max_buffers members during the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call itself.</p>
<p>If the stream is new, max_buffer, and private pointer fields of the stream structure will all be set to 0. The usage will be set to the consumer usage flags. The HAL device must set these fields before the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call returns. These fields are then used by the framework and the platform gralloc module to allocate the gralloc buffers for each stream.</p>
<p>Before such a new stream can have its buffers included in a capture request, the framework will call <a class="el" href="structcamera3__device__ops.html#a8b564eaecece3af81a5be5db1e817fb9">register_stream_buffers()</a> with that stream. However, the framework is not required to register buffers for <em>all</em> streams before submitting a request. This allows for quick startup of (for example) a preview stream, with allocation for other streams happening later or concurrently. </p>
<hr/>
<p> &gt;= CAMERA_DEVICE_API_VERSION_3_2:</p>
<p>Reset the HAL camera device processing pipeline and set up new input and output streams. This call replaces any existing stream configuration with the streams defined in the stream_list. This method will be called at least once after <a class="el" href="structcamera3__device__ops.html#a8d000d2a2a425867f83d212aa7eece27">initialize()</a> before a request is submitted with <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a>.</p>
<p>The stream_list must contain at least one output-capable stream, and may not contain more than one input-capable stream.</p>
<p>The stream_list may contain streams that are also in the currently-active set of streams (from the previous call to configure_stream()). These streams will already have valid values for usage, max_buffers, and the private pointer.</p>
<p>If the HAL needs to change the stream configuration for an existing stream due to the new configuration, it may rewrite the values of usage and/or max_buffers during the configure call.</p>
<p>The framework will detect such a change, and may then reallocate the stream buffers before using buffers from that stream in a request.</p>
<p>If a currently-active stream is not included in stream_list, the HAL may safely remove any references to that stream. It will not be reused in a later configure() call by the framework, and all the gralloc buffers for it will be freed after the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call returns.</p>
<p>The stream_list structure is owned by the framework, and may not be accessed once this call completes. The address of an individual camera3_stream_t structure will remain valid for access by the HAL until the end of the first configure_stream() call which no longer includes that camera3_stream_t in the stream_list argument. The HAL may not change values in the stream structure outside of the private pointer, except for the usage and max_buffers members during the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call itself.</p>
<p>If the stream is new, max_buffer, and private pointer fields of the stream structure will all be set to 0. The usage will be set to the consumer usage flags. The HAL device must set these fields before the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call returns. These fields are then used by the framework and the platform gralloc module to allocate the gralloc buffers for each stream.</p>
<p>Newly allocated buffers may be included in a capture request at any time by the framework. Once a gralloc buffer is returned to the framework with process_capture_result (and its respective release_fence has been signaled) the framework may free or reuse it at any time. </p>
<hr/>
<p>Preconditions:</p>
<p>The framework will only call this method when no captures are being processed. That is, all results have been returned to the framework, and all in-flight input and output buffers have been returned and their release sync fences have been signaled by the HAL. The framework will not submit new requests for capture while the <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call is underway.</p>
<p>Postconditions:</p>
<p>The HAL device must configure itself to provide maximum possible output frame rate given the sizes and formats of the output streams, as documented in the camera device's static metadata.</p>
<p>Performance requirements:</p>
<p>This call is expected to be heavyweight and possibly take several hundred milliseconds to complete, since it may require resetting and reconfiguring the image sensor and the camera processing pipeline. Nevertheless, the HAL device should attempt to minimize the reconfiguration delay to minimize the user-visible pauses during application operational mode changes (such as switching from still capture to video recording).</p>
<p>The HAL should return from this call in 500ms, and must return from this call in 1000ms.</p>
<p>Return values:</p>
<p>0: On successful stream configuration</p>
<p>-EINVAL: If the requested stream configuration is invalid. Some examples of invalid stream configurations include:</p>
<ul>
<li>Including more than 1 input-capable stream (INPUT or BIDIRECTIONAL)</li>
<li>Not including any output-capable streams (OUTPUT or BIDIRECTIONAL)</li>
<li>Including streams with unsupported formats, or an unsupported size for that format.</li>
<li>Including too many output streams of a certain format.</li>
<li>Unsupported rotation configuration (only applies to devices with version &gt;= CAMERA_DEVICE_API_VERSION_3_3)</li>
<li>Stream sizes/formats don't satisfy the camera3_stream_configuration_t-&gt;operation_mode requirements for non-NORMAL mode, or the requested operation_mode is not supported by the HAL. (only applies to devices with version &gt;= CAMERA_DEVICE_API_VERSION_3_3)</li>
</ul>
<p>Note that the framework submitting an invalid stream configuration is not normal operation, since stream configurations are checked before configure. An invalid configuration means that a bug exists in the framework code, or there is a mismatch between the HAL's static metadata and the requirements on streams.</p>
<p>-ENODEV: If there has been a fatal error and the device is no longer operational. Only close() can be called successfully by the framework after this error is returned. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02769">2769</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab2ac0e77ced61544947f40eb328ccb31"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="camera__common_8h.html#a650c3d4440786f728ec509ceb6e7a56c">camera_metadata_t</a>*(* construct_default_request_settings)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, int type)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>construct_default_request_settings:</p>
<p>Create capture settings for standard camera use cases.</p>
<p>The device must return a settings buffer that is configured to meet the requested use case, which must be one of the CAMERA3_TEMPLATE_* enums. All request control fields must be included.</p>
<p>The HAL retains ownership of this structure, but the pointer to the structure must be valid until the device is closed. The framework and the HAL may not modify the buffer once it is returned by this call. The same buffer may be returned for subsequent calls for the same template, or for other templates.</p>
<p>Performance requirements:</p>
<p>This should be a non-blocking call. The HAL should return from this call in 1ms, and must return from this call in 5ms.</p>
<p>Return values:</p>
<p>Valid metadata: On successful creation of a default settings buffer.</p>
<p>NULL: In case of a fatal error. After this is returned, only the close() method can be called successfully by the framework. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02859">2859</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac158a8b077d97e34e6878934594dccbb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* dump)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, int fd)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>dump:</p>
<p>Print out debugging state for the camera device. This will be called by the framework when the camera service is asked for a debug dump, which happens when using the dumpsys tool, or when capturing a bugreport.</p>
<p>The passed-in file descriptor can be used to write debugging text using dprintf() or write(). The text should be in ASCII encoding only.</p>
<p>Performance requirements:</p>
<p>This must be a non-blocking call. The HAL should return from this call in 1ms, must return from this call in 10ms. This call must avoid deadlocks, as it may be called at any point during camera operation. Any synchronization primitives used (such as mutex locks or semaphores) should be acquired with a timeout. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02971">2971</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2bd084c17ec0b22a60fc0f41c6626976"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* flush)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>flush:</p>
<p>Flush all currently in-process captures and all buffers in the pipeline on the given device. The framework will use this to dump all state as quickly as possible in order to prepare for a <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call.</p>
<p>No buffers are required to be successfully returned, so every buffer held at the time of <a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush()</a> (whether successfully filled or not) may be returned with CAMERA3_BUFFER_STATUS_ERROR. Note the HAL is still allowed to return valid (CAMERA3_BUFFER_STATUS_OK) buffers during this call, provided they are successfully filled.</p>
<p>All requests currently in the HAL are expected to be returned as soon as possible. Not-in-process requests should return errors immediately. Any interruptible hardware blocks should be stopped, and any uninterruptible blocks should be waited on.</p>
<p><a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush()</a> may be called concurrently to <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a>, with the expectation that process_capture_request will return quickly and the request submitted in that process_capture_request call is treated like all other in-flight requests. Due to concurrency issues, it is possible that from the HAL's point of view, a <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a> call may be started after flush has been invoked but has not returned yet. If such a call happens before <a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush()</a> returns, the HAL should treat the new capture request like other in-flight pending requests (see #4 below).</p>
<p>More specifically, the HAL must follow below requirements for various cases:</p>
<ol type="1">
<li>For captures that are too late for the HAL to cancel/stop, and will be completed normally by the HAL; i.e. the HAL can send shutter/notify and process_capture_result and buffers as normal.</li>
<li>For pending requests that have not done any processing, the HAL must call notify CAMERA3_MSG_ERROR_REQUEST, and return all the output buffers with process_capture_result in the error state (CAMERA3_BUFFER_STATUS_ERROR). The HAL must not place the release fence into an error state, instead, the release fences must be set to the acquire fences passed by the framework, or -1 if they have been waited on by the HAL already. This is also the path to follow for any captures for which the HAL already called notify() with CAMERA3_MSG_SHUTTER but won't be producing any metadata/valid buffers for. After CAMERA3_MSG_ERROR_REQUEST, for a given frame, only process_capture_results with buffers in CAMERA3_BUFFER_STATUS_ERROR are allowed. No further notifys or process_capture_result with non-null metadata is allowed.</li>
<li><p class="startli">For partially completed pending requests that will not have all the output buffers or perhaps missing metadata, the HAL should follow below:</p>
<p class="startli">3.1. Call notify with CAMERA3_MSG_ERROR_RESULT if some of the expected result metadata (i.e. one or more partial metadata) won't be available for the capture.</p>
<p class="startli">3.2. Call notify with CAMERA3_MSG_ERROR_BUFFER for every buffer that won't be produced for the capture.</p>
<p class="startli">3.3 Call notify with CAMERA3_MSG_SHUTTER with the capture timestamp before any buffers/metadata are returned with process_capture_result.</p>
<p class="startli">3.4 For captures that will produce some results, the HAL must not call CAMERA3_MSG_ERROR_REQUEST, since that indicates complete failure.</p>
<p class="startli">3.5. Valid buffers/metadata should be passed to the framework as normal.</p>
<p class="startli">3.6. Failed buffers should be returned to the framework as described for case 2. But failed buffers do not have to follow the strict ordering valid buffers do, and may be out-of-order with respect to valid buffers. For example, if buffers A, B, C, D, E are sent, D and E are failed, then A, E, B, D, C is an acceptable return order.</p>
<p class="startli">3.7. For fully-missing metadata, calling CAMERA3_MSG_ERROR_RESULT is sufficient, no need to call process_capture_result with NULL metadata or equivalent.</p>
</li>
<li>If a <a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush()</a> is invoked while a <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a> invocation is active, that process call should return as soon as possible. In addition, if a <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a> call is made after <a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush()</a> has been invoked but before <a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush()</a> has returned, the capture request provided by the late process_capture_request call should be treated like a pending request in case #2 above.</li>
</ol>
<p><a class="el" href="structcamera3__device__ops.html#a2bd084c17ec0b22a60fc0f41c6626976">flush()</a> should only return when there are no more outstanding buffers or requests left in the HAL. The framework may call configure_streams (as the HAL state is now quiesced) or may issue new requests.</p>
<p>Note that it's sufficient to only support fully-succeeded and fully-failed result cases. However, it is highly desirable to support the partial failure cases as well, as it could help improve the flush call overall performance.</p>
<p>Performance requirements:</p>
<p>The HAL should return from this call in 100ms, and must return from this call in 1000ms. And this call must not be blocked longer than pipeline latency (see S7 for definition).</p>
<p>Version information:</p>
<p>only available if device version &gt;= CAMERA_DEVICE_API_VERSION_3_1.</p>
<p>Return values:</p>
<p>0: On a successful flush of the camera HAL.</p>
<p>-EINVAL: If the input is malformed (the device is not valid).</p>
<p>-ENODEV: If the camera device has encountered a serious error. After this error is returned, only the close() method can be successfully called by the framework. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l03077">3077</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa33d0dc56ecc55cd06f8ba64de8f3b06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* get_metadata_vendor_tag_ops)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, vendor_tag_query_ops_t *ops)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>get_metadata_vendor_tag_ops:</p>
<p>Get methods to query for vendor extension metadata tag information. The HAL should fill in all the vendor tag operation methods, or leave ops unchanged if no vendor tags are defined.</p>
<p>The definition of vendor_tag_query_ops_t can be found in system/media/camera/include/system/camera_metadata.h.</p>
<p>&gt;= CAMERA_DEVICE_API_VERSION_3_2: DEPRECATED. This function has been deprecated and should be set to NULL by the HAL. Please implement get_vendor_tag_ops in <a class="el" href="camera__common_8h.html">camera_common.h</a> instead. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02950">2950</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8d000d2a2a425867f83d212aa7eece27"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* initialize)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, const <a class="el" href="camera3_8h.html#a34ca9e651598163bb6e401d1db3da359">camera3_callback_ops_t</a> *callback_ops)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>initialize:</p>
<p>One-time initialization to pass framework callback function pointers to the HAL. Will be called once after a successful open() call, before any other functions are called on the <a class="el" href="structcamera3__device__ops.html">camera3_device_ops</a> structure.</p>
<p>Performance requirements:</p>
<p>This should be a non-blocking call. The HAL should return from this call in 5ms, and must return from this call in 10ms.</p>
<p>Return values:</p>
<p>0: On successful initialization</p>
<p>-ENODEV: If initialization fails. Only close() can be called successfully by the framework after this. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02530">2530</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="a93ed24e27cb47f7f907c0bb56b114009"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* process_capture_request)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, <a class="el" href="camera3_8h.html#afea9dcedcccdb56f68567f8c9bbb0405">camera3_capture_request_t</a> *request)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>process_capture_request:</p>
<p>Send a new capture request to the HAL. The HAL should not return from this call until it is ready to accept the next request to process. Only one call to <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a> will be made at a time by the framework, and the calls will all be from the same thread. The next call to <a class="el" href="structcamera3__device__ops.html#a93ed24e27cb47f7f907c0bb56b114009">process_capture_request()</a> will be made as soon as a new request and its associated buffers are available. In a normal preview scenario, this means the function will be called again by the framework almost instantly.</p>
<p>The actual request processing is asynchronous, with the results of capture being returned by the HAL through the process_capture_result() call. This call requires the result metadata to be available, but output buffers may simply provide sync fences to wait on. Multiple requests are expected to be in flight at once, to maintain full output frame rate.</p>
<p>The framework retains ownership of the request structure. It is only guaranteed to be valid during this call. The HAL device must make copies of the information it needs to retain for the capture processing. The HAL is responsible for waiting on and closing the buffers' fences and returning the buffer handles to the framework.</p>
<p>The HAL must write the file descriptor for the input buffer's release sync fence into input_buffer-&gt;release_fence, if input_buffer is not NULL. If the HAL returns -1 for the input buffer release sync fence, the framework is free to immediately reuse the input buffer. Otherwise, the framework will wait on the sync fence before refilling and reusing the input buffer.</p>
<p>&gt;= CAMERA_DEVICE_API_VERSION_3_2:</p>
<p>The input/output buffers provided by the framework in each request may be brand new (having never before seen by the HAL). </p>
<hr/>
<p> Performance considerations:</p>
<p>Handling a new buffer should be extremely lightweight and there should be no frame rate degradation or frame jitter introduced.</p>
<p>This call must return fast enough to ensure that the requested frame rate can be sustained, especially for streaming cases (post-processing quality settings set to FAST). The HAL should return this call in 1 frame interval, and must return from this call in 4 frame intervals.</p>
<p>Return values:</p>
<p>0: On a successful start to processing the capture request</p>
<p>-EINVAL: If the input is malformed (the settings are NULL when not allowed, there are 0 output buffers, etc) and capture processing cannot start. Failures during request processing should be handled by calling <a class="el" href="structcamera3__callback__ops.html#a6d702d6e962f95105b984b17462619b3">camera3_callback_ops_t.notify()</a>. In case of this error, the framework will retain responsibility for the stream buffers' fences and the buffer handles; the HAL should not close the fences or return these buffers with process_capture_result.</p>
<p>-ENODEV: If the camera device has encountered a serious error. After this error is returned, only the close() method can be successfully called by the framework. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02928">2928</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8b564eaecece3af81a5be5db1e817fb9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* register_stream_buffers)(const struct <a class="el" href="structcamera3__device.html">camera3_device</a> *, const <a class="el" href="camera3_8h.html#a6bf819e9c2aee2ccc9a7ea86639efb20">camera3_stream_buffer_set_t</a> *buffer_set)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>register_stream_buffers:</p>
<p>&gt;= CAMERA_DEVICE_API_VERSION_3_2:</p>
<p>DEPRECATED. This will not be called and must be set to NULL.</p>
<p>&lt;= CAMERA_DEVICE_API_VERSION_3_1:</p>
<p>Register buffers for a given stream with the HAL device. This method is called by the framework after a new stream is defined by configure_streams, and before buffers from that stream are included in a capture request. If the same stream is listed in a subsequent <a class="el" href="structcamera3__device__ops.html#a48a246bfc7ecebac9d27c58151648539">configure_streams()</a> call, register_stream_buffers will <em>not</em> be called again for that stream.</p>
<p>The framework does not need to register buffers for all configured streams before it submits the first capture request. This allows quick startup for preview (or similar use cases) while other streams are still being allocated.</p>
<p>This method is intended to allow the HAL device to map or otherwise prepare the buffers for later use. The buffers passed in will already be locked for use. At the end of the call, all the buffers must be ready to be returned to the stream. The buffer_set argument is only valid for the duration of this call.</p>
<p>If the stream format was set to HAL_PIXEL_FORMAT_IMPLEMENTATION_DEFINED, the camera HAL should inspect the passed-in buffers here to determine any platform-private pixel format information.</p>
<p>Performance requirements:</p>
<p>This should be a non-blocking call. The HAL should return from this call in 1ms, and must return from this call in 5ms.</p>
<p>Return values:</p>
<p>0: On successful registration of the new stream buffers</p>
<p>-EINVAL: If the stream_buffer_set does not refer to a valid active stream, or if the buffers array is invalid.</p>
<p>-ENOMEM: If there was a failure in registering the buffers. The framework must consider all the stream buffers to be unregistered, and can try to register again later.</p>
<p>-ENODEV: If there is a fatal error, and the device is no longer operational. Only close() can be called successfully by the framework after this error is returned. </p>

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l02823">2823</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4ee8b7f36386fa3dd3e253feaf0931b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* reserved[8]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html#l03080">3080</a> of file <a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>hardware/libhardware/include/hardware/<a class="el" href="http://source.android.com/devices/halref/camera3_8h_source.html">camera3.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="structcamera3__device__ops.html">camera3_device_ops</a></li>
    <li class="footer">Generated on Mon Jun 20 2016 18:43:21 for Android Hardware Abstraction Layer by
    <a href="http://source.android.com/index.html">
    <img class="footer" src="http://source.android.com/images/Android_Robot_100.png" alt="Android"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
